ä¸€ã€æŠ€æœ¯ç‚¹æè¿°

- **é¡¹ç›®å·¥ç¨‹åŒ–æ”¹é€ ï¼š**ç¼–å†™å¹¶é…ç½®å¤–å±‚é¡¹ç›®çš„`webpack`ï¼Œå®ç°ç»Ÿä¸€ä¸‹è½½å­é¡¹ç›®ä¾èµ–ï¼Œä¸€é”®æ„å»ºä¸åŒå­é¡¹ç›®

## äºŒã€å…³äºè¯¥ç‚¹å›ç­”

- **`npm workspaces`ï¼š**å¢åŠ `workspaces`å‚æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥ç›´æ¥åœ¨æœ€å¤–å±‚çš„`vue`é¡¹ç›®ä¸Šæ‰§è¡Œ`npm install`å‘½ä»¤ä¸‹è½½æ‰€æœ‰å­é¡¹ç›®çš„ä¾èµ–ï¼Œä½†è¿™ä¸ªé…ç½®é¡¹çš„`node`è¦æ±‚ä¸º`16+`ï¼Œå› ä¸ºæˆ‘ä»¬å½“å‰é¡¹ç›®çš„`node`ä¸º`14.15.1`ï¼Œæ‰€ä»¥æˆ‘åœ¨æœ€å¤–å±‚ç›´æ¥æ‰§è¡Œ`npm install`æŠ¥é”™äº†ï¼Œä½¿ç”¨`npm install -- legacy-peer-deps` å‘½ä»¤å¯ä»¥æˆåŠŸä¸‹è½½ä¾èµ–ã€‚

- ![project6](..\..\images\project6.png)

- åœ¨`package.json`æ–‡ä»¶ä¸­çš„`script`å­—æ®µé‡Œé¢ä¸»è¦é…ç½®æ„å»ºè„šæœ¬ï¼Œä½¿ç”¨`PROJECT_NAME`å˜é‡æ¥åŒºåˆ†æ„å»ºçš„æ˜¯é‚£ä¸ªé¡¹ç›®

  ![project2](..\..\images\project2.png)

- åœ¨æœ€å¤–å±‚çš„`vue.config.js`ä¸­æ ¹æ®PROJECT_NAMEè¯»å–ä¸ªé¡¹ç›®çš„`main.js`å…¥å£æ–‡ä»¶ï¼Œå­é¡¹ç›®çš„`vue.config.js`ä»¥åŠé…ç½®æ‰“åŒ…æ–‡ä»¶ç›®å½•

  - å¤–å±‚é¡¹ç›®ä¸å†å‚ä¸æ„å»ºï¼Œåªè´Ÿè´£ï¼š
    - åˆ†åˆ«æ‰§è¡Œ `npm run build`
    - å°† `dist` æ‹·è´åˆ°ç»Ÿä¸€ç›®å½•
    - æ‰“åŒ…æˆ `Docker` é•œåƒ

- è¿™æ ·è®¾è®¡ä¸»è¦è¿˜æ˜¯ä¿è¯é¡¹ç›®é…ç½®ç‹¬ç«‹æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿä¸€æ¬¡æ„å»ºå®Œæˆ`ci/cd`æµç¨‹ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°åç»­å¯èƒ½å…¼å®¹ä¸åŒæŠ€æœ¯æ ˆçš„é¡¹ç›®

## ä¸‰ã€è¡ç”Ÿé—®é¢˜

### 1ã€è¯¥é¡¹ç›®æ–¹æ¡ˆæ˜¯çœŸæ­£çš„ä¸€æ¬¡æ„å»ºå—ï¼Ÿ

```
# åœ¨ vue.config.js ä¸­æ‰§è¡Œï¼š
cross-env project_name=model vue-cli-service build && cross-env project_name=rhea vue-cli-service build
```

- **è¿™ä¸æ˜¯â€œçœŸæ­£çš„ä¸€æ¬¡æ„å»ºâ€**ï¼Œè™½ç„¶å‘½ä»¤å†™åœ¨ `vue.config.js` é‡Œï¼Œçœ‹èµ·æ¥åƒæ˜¯â€œç»Ÿä¸€é…ç½®â€ï¼Œä½†æœ¬è´¨ä¸Šæ˜¯ **ä¸²è¡Œæ‰§è¡Œäº†ä¸¤æ¬¡ç‹¬ç«‹çš„ `vue-cli-service build` æ„å»ºè¿‡ç¨‹**ã€‚

#### 1.1ã€ æ·±å…¥è§£æï¼šä¸ºä»€ä¹ˆä¸æ˜¯â€œä¸€æ¬¡æ„å»ºâ€ï¼Ÿ

##### ï¼ˆ1ï¼‰ æ„å»ºè¿›ç¨‹æ˜¯åˆ†å¼€çš„

- æ¯æ¬¡`vue-cli-service build`éƒ½ä¼šï¼š
  - å¯åŠ¨ä¸€ä¸ªå…¨æ–°çš„ `Node.js` è¿›ç¨‹
  - é‡æ–°åŠ è½½ `Webpack` é…ç½®
  - é‡æ–°è§£æä¾èµ–ï¼ˆ`node_modules`ï¼‰
  - ç‹¬ç«‹å®Œæˆç¼–è¯‘ã€æ‰“åŒ…ã€ä¼˜åŒ–
- ä¸¤ä¸ªé¡¹ç›®ä¹‹é—´**æ²¡æœ‰å…±äº«æ„å»ºä¸Šä¸‹æ–‡**

##### ï¼ˆ2ï¼‰ä¾èµ–å®‰è£…ä¸è§£ææ˜¯éš”ç¦»çš„

- å³ä½¿å…±ç”¨ `node_modules`ï¼Œä½†æ¯æ¬¡æ„å»ºéƒ½ç‹¬ç«‹è¿›è¡Œæ¨¡å—è§£æ
- æ— æ³•å®ç°è·¨é¡¹ç›®çš„ `splitChunks` å…¬å…±åŒ…æå–ï¼ˆé™¤éæ‰‹åŠ¨å¤åˆ¶ `JS` æ–‡ä»¶ï¼‰

##### ï¼ˆ3ï¼‰æ„å»ºä¸Šä¸‹æ–‡ä¸ç»Ÿä¸€

- ç¬¬ä¸€æ¬¡æ„å»ºä¸çŸ¥é“ç¬¬äºŒæ¬¡è¦æ„å»ºä»€ä¹ˆ
- æ²¡æœ‰å…¨å±€çš„æ¨¡å—å›¾ï¼ˆ`Module Graph`ï¼‰æ¥ä¼˜åŒ–æ•´ä½“åŒ…ç»“æ„
- `tree-shaking`ã€`scope hoisting` æ— æ³•è·¨é¡¹ç›®ç”Ÿæ•ˆ

##### ï¼ˆ4ï¼‰è¾“å‡ºæ˜¯æ‹¼æ¥çš„ï¼Œä¸æ˜¯ç”Ÿæˆçš„

- `dist/model/` å’Œ `dist/rhea/` æ˜¯ä¸¤ä¸ªç‹¬ç«‹æ„å»ºäº§ç‰©
- å¤–å±‚é¡¹ç›®æ²¡æœ‰å‚ä¸çœŸæ­£çš„â€œæ‰“åŒ…â€è¿‡ç¨‹ï¼Œåªæ˜¯â€œç›®å½•èšåˆâ€

#### 1.2ã€ è¿™å±äºä»€ä¹ˆæ¨¡å¼ï¼Ÿ

- è¿™å±äºï¼š**â€œèšåˆå¼æ„å»ºâ€ï¼ˆAggregated Buildï¼‰** æˆ– **â€œä¸€é”®å¤šæ„å»ºâ€ï¼ˆOne-click Multi-buildï¼‰**
- å®ƒå…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š
  - âœ… ä¸€ä¸ªå‘½ä»¤è§¦å‘å¤šä¸ªæ„å»º
  - âœ… æœ€ç»ˆéƒ¨ç½²å¯ä»¥ç»Ÿä¸€ï¼ˆå¦‚æ‰“åŒ…æˆä¸€ä¸ª Docker é•œåƒï¼‰
  - âœ… ä¸Šçº¿æµç¨‹ç®€åŒ–ï¼ˆä¸€æ¬¡ CI/CD æµæ°´çº¿ï¼‰
  - âŒ ä½†**ä¸æ˜¯å·¥ç¨‹åŒ–å±‚é¢çš„çœŸæ­£ä¸€æ¬¡æ„å»º**

#### 1.3ã€ä»€ä¹ˆæ˜¯â€œçœŸæ­£çš„ä¸€æ¬¡æ„å»ºâ€ï¼Ÿ

- ç”±**ä¸€ä¸ª Webpack å®ä¾‹**ç»Ÿä¸€å¤„ç†æ‰€æœ‰å…¥å£

  ```
  // vue.config.jsï¼ˆå¤–å±‚é¡¹ç›®ï¼‰
  module.exports = {
    // å¤šå…¥å£é…ç½®
    pages: {
      model: {
        entry: './projects/model/main.js',
        template: 'public/model.html',
        filename: 'model/index.html'
      },
      rhea: {
        entry: './projects/rhea/main.js',
        template: 'public/rhea.html',
        filename: 'rhea/index.html'
      }
    },
  
    // ç»Ÿä¸€ä¼˜åŒ–ï¼šè·¨é¡¹ç›®æå–å…¬å…±åŒ…
    configureWebpack: {
      optimization: {
        splitChunks: {
          cacheGroups: {
            vendor: {
              name: 'vendor',
              test: /[\\/]node_modules[\\/]/,
              chunks: 'all',
              priority: 10
            },
            common: {
              name: 'common',
              minChunks: 2, // åªè¦è¢«ä¸¤ä¸ªé¡¹ç›®å¼•ç”¨å°±æå–
              chunks: 'all'
            }
          }
        }
      }
    }
  }
  ```

- ç„¶åè¿è¡Œï¼š

  ```
  npm run build  # åªæ‰§è¡Œä¸€æ¬¡ï¼ŒWebpack è‡ªåŠ¨æ„å»ºæ‰€æœ‰å…¥å£
  ```

- è¿™æ‰æ˜¯**çœŸæ­£çš„ä¸€æ¬¡æ„å»º**ï¼š**ä¸€ä¸ªæ„å»ºè¿›ç¨‹ã€ç»Ÿä¸€ä¸Šä¸‹æ–‡ã€å…¨å±€ä¼˜åŒ–**ã€‚

#### 1.4ã€å½“å‰æ–¹å¼çš„ä¼˜ç¼ºç‚¹æ€»ç»“

| ç‰¹æ€§           | çŠ¶æ€   | è¯´æ˜                                     |
| -------------- | ------ | ---------------------------------------- |
| æ˜¯å¦ä¸€æ¬¡æ„å»º   | âŒ å¦   | æœ¬è´¨æ˜¯ä¸¤æ¬¡ç‹¬ç«‹æ„å»ºä¸²è¡Œæ‰§è¡Œ               |
| æ˜¯å¦ç»Ÿä¸€éƒ¨ç½²   | âœ… æ˜¯   | å¯ä»¥æŠŠ `dist` æ‰“åŒ…æˆä¸€ä¸ªé•œåƒ             |
| èƒ½å¦æå–å…¬å…±åŒ… | âš ï¸ æœ‰é™ | åªèƒ½åœ¨å•ä¸ªé¡¹ç›®å†… splitChunksï¼Œæ— æ³•è·¨é¡¹ç›® |
| å·¥ç¨‹å¤æ‚åº¦     | âœ… ä½   | å®ç°ç®€å•ï¼Œé€‚åˆå¿«é€Ÿè½åœ°                   |
| æ„å»ºæ€§èƒ½       | âš ï¸ ä¸€èˆ¬ | é‡å¤è§£æä¾èµ–ï¼Œæ— ç¼“å­˜å…±äº«                 |

#### 1.5ã€æ€»ç»“å›ç­”

- â€œä¸¥æ ¼æ¥è¯´ï¼Œè¿™ç§æ–¹å¼ä¸ç®—â€˜çœŸæ­£çš„ä¸€æ¬¡æ„å»ºâ€™ã€‚è™½ç„¶æˆ‘ä»¬åœ¨ `vue.config.js` ä¸­é€šè¿‡ shell å‘½ä»¤ä¸²è¡Œæ‰§è¡Œäº†å¤šä¸ªå­é¡¹ç›®çš„æ„å»ºï¼Œçœ‹èµ·æ¥åƒæ˜¯ç»Ÿä¸€æ§åˆ¶ï¼Œä½†å®é™…ä¸Šæ¯æ¬¡ `vue-cli-service build` éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ„å»ºè¿›ç¨‹ï¼Œæœ‰è‡ªå·±å®Œæ•´çš„ä¾èµ–è§£æã€ç¼–è¯‘å’Œæ‰“åŒ…æµç¨‹ã€‚
- çœŸæ­£çš„â€˜ä¸€æ¬¡æ„å»ºâ€™åº”è¯¥æ˜¯ç”±ä¸€ä¸ª Webpack å®ä¾‹ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å…¥å£æ–‡ä»¶ï¼Œåœ¨åŒä¸€ä¸ªæ„å»ºä¸Šä¸‹æ–‡ä¸­å®Œæˆå…¨å±€ä¾èµ–åˆ†æã€å…¬å…±ä»£ç æå–å’Œæ•´ä½“ä¼˜åŒ–ã€‚è€Œæˆ‘ä»¬çš„æ–¹å¼æ›´å‡†ç¡®åœ°è¯´æ˜¯â€˜**èšåˆå¼æ„å»º**â€™æˆ–â€˜**ä¸€é”®å¤šæ„å»º**â€™ï¼Œå®ƒç®€åŒ–äº†ä¸Šçº¿æµç¨‹ï¼Œæå‡äº†éƒ¨ç½²æ•ˆç‡ï¼Œä½†åœ¨æ„å»ºå±‚é¢ä»æ˜¯åˆ†ç¦»çš„ã€‚
- ä¸è¿‡ï¼Œåœ¨å½“æ—¶æ‰€æœ‰é¡¹ç›®éƒ½æ˜¯ Vue æŠ€æœ¯æ ˆã€è¿½æ±‚å¿«é€Ÿè½åœ°çš„èƒŒæ™¯ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆç†ä¸”é«˜æ•ˆçš„æŠ˜ä¸­æ–¹æ¡ˆã€‚â€

#### 1.6ã€å®ç°çœŸæ­£çš„ä¸€æ¬¡æ„å»º + å¤šå…¥å£ + å…¬å…±èµ„æºæå–

- å¦‚æœæƒ³å®ç°**çœŸæ­£çš„ä¸€æ¬¡æ„å»º + å¤šå…¥å£ + å…¬å…±èµ„æºæå–**ï¼Œåº”è¯¥ï¼š

  1. **ä¸è¦åœ¨ `chainWebpack` é‡Œæ‰§è¡Œ `npm run build`**
  2. **è€Œæ˜¯ç”¨ `chainWebpack` é…ç½®å¤šå…¥å£å’Œ splitChunks**
  3. **è®©æ‰€æœ‰å­é¡¹ç›®ä½œä¸ºå…¥å£è¢«åŒä¸€ä¸ª webpack å®ä¾‹æ„å»º**

  ```
  // vue.config.js
  module.exports = {
    chainWebpack: config => {
      // åŠ¨æ€æ·»åŠ å¤šä¸ªå­é¡¹ç›®å…¥å£
      const projects = ['model', 'rhea', 'risk'];
      projects.forEach(name => {
        config.entry(name)
          .add(`./projects/${name}/main.js`)
          .end()
      })
  
      // ç»Ÿä¸€ä¼˜åŒ–
      config.optimization.splitChunks({
        cacheGroups: {
          libs: {
            name: 'chunk-libs',
            test: /[\\/]node_modules[\\/]/,
            priority: 10,
            chunks: 'all'
          },
          common: {
            name: 'chunk-common',
            minChunks: 2,
            priority: 5,
            chunks: 'all'
          }
        }
      })
    }
  }
  ```

  - ç„¶åè¿è¡Œï¼š

    ```
    npm run build  # åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ„å»ºæ‰€æœ‰é¡¹ç›®
    ```

#### 1.7ã€ çœŸæ­£çš„ä¸€æ¬¡æ„å»º`vue.config.js` å®Œæ•´ç¤ºä¾‹

- âœ… å®ç° **çœŸæ­£çš„ä¸€æ¬¡æ„å»º**
- âœ… æ”¯æŒ **å¤šå…¥å£ï¼ˆmodelã€rhea ç­‰ï¼‰**
- âœ… è‡ªåŠ¨æå– **è·¨é¡¹ç›®å…¬å…±ä¾èµ–**
- âœ… æ¯ä¸ªé¡¹ç›®è¾“å‡ºç‹¬ç«‹ç›®å½•ï¼ˆ`dist/model/`, `dist/rhea/`ï¼‰
- âœ… æ”¯æŒ **HTML æ¨¡æ¿åˆ†ç¦»** å’Œ **èµ„æºä¼˜åŒ–**

```
// vue.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const { DefinePlugin } = require('webpack');

// é¡¹ç›®åˆ—è¡¨ï¼ˆå¯ä»æ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨è¯»å–ï¼Œä¹Ÿå¯æ‰‹åŠ¨ç»´æŠ¤ï¼‰
const PROJECTS = [
  { name: 'model', title: 'æ¨¡å‹å¹³å°' },
  { name: 'rhea', title: 'Rhea ç³»ç»Ÿ' },
  // å¯ç»§ç»­æ·»åŠ å…¶ä»–é¡¹ç›®
];

module.exports = {
  // åŸºç¡€è·¯å¾„ï¼Œæ ¹æ®éƒ¨ç½²ç¯å¢ƒè°ƒæ•´
  publicPath: process.env.NODE_ENV === 'production' ? '/' : '/',

  // è¾“å‡ºç›®å½•
  outputDir: 'dist',

  // æ¯ä¸ªé¡¹ç›®è¾“å‡ºåˆ°ç‹¬ç«‹å­ç›®å½•
  assetsDir: undefined, // æˆ‘ä»¬é€šè¿‡ pages æ§åˆ¶è·¯å¾„

  // å…³é—­ç”Ÿäº§ç¯å¢ƒçš„ source mapï¼ˆå¯é€‰ï¼‰
  productionSourceMap: false,

  // é…ç½® webpack
  chainWebpack: (config) => {
    // æ¸…é™¤é»˜è®¤çš„ HTML æ’ä»¶ï¼ˆæˆ‘ä»¬å°†æ‰‹åŠ¨æ·»åŠ ï¼‰
    config.plugins.delete('html');
    config.plugins.delete('preload');
    config.plugins.delete('prefetch');

    // åŠ¨æ€æ·»åŠ æ¯ä¸ªé¡¹ç›®çš„ entry å’Œ HTML æ’ä»¶
    PROJECTS.forEach(({ name, title }) => {
      // âœ… æ·»åŠ å…¥å£
      config
        .entry(name)
        .add(path.resolve(__dirname, `src-projects/${name}/main.js`))
        .end();

      // âœ… é…ç½®è¾“å‡ºçš„ HTML æ–‡ä»¶
      const htmlPlugin = new HtmlWebpackPlugin({
        filename: `${name}/index.html`, // è¾“å‡ºåˆ° dist/model/index.html
        template: path.resolve(__dirname, `public/${name}.html`), // æ¯ä¸ªé¡¹ç›®å¯æœ‰è‡ªå·±çš„æ¨¡æ¿
        title, // é¡µé¢æ ‡é¢˜
        chunks: [name, 'chunk-vendors', 'chunk-common'], // å¼•å…¥å½“å‰å…¥å£ + å…¬å…±åŒ…
        minify: {
          removeComments: true,
          collapseWhitespace: true,
          removeAttributeQuotes: true,
        },
      });

      config.plugin(`html-${name}`).use(htmlPlugin);
    });

    // âœ… é…ç½®è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆJS/CSSï¼‰
    config.output
      .filename('js/[name]/[name].[contenthash:8].js')
      .chunkFilename('js/[name]/chunk.[contenthash:8].js');

    // âœ… é…ç½®é™æ€èµ„æºè·¯å¾„
    config.module
      .rule('images')
      .use('url-loader')
      .tap((options) => {
        options.name = 'img/[name].[hash:8].[ext]';
        return options;
      });

    config.module
      .rule('fonts')
      .use('url-loader')
      .tap((options) => {
        options.name = 'fonts/[name].[hash:8].[ext]';
        return options;
      });

    // âœ… ä¼˜åŒ–ï¼šsplitChunks æå–å…¬å…±ä»£ç 
    config.optimization.splitChunks({
      chunks: 'all',
      cacheGroups: {
        // 1. ç¬¬ä¸‰æ–¹ä¾èµ–
        vendors: {
          name: 'chunk-vendors',
          test: /[\\/]node_modules[\\/]/,
          priority: 10,
          filename: 'js/[name].[contenthash:8].js',
        },
        // 2. å¤šä¸ªé¡¹ç›®å…±ç”¨çš„ä»£ç ï¼ˆutilsã€components ç­‰ï¼‰
        common: {
          name: 'chunk-common',
          minChunks: 2, // è‡³å°‘è¢«ä¸¤ä¸ªé¡¹ç›®å¼•ç”¨
          priority: 5,
          reuseExistingChunk: true,
          filename: 'js/[name].[contenthash:8].js',
        },
      },
    });

    // âœ… å¯é€‰ï¼šå®šä¹‰å…¨å±€å¸¸é‡ï¼Œå‘Šè¯‰å­é¡¹ç›®å½“å‰è¿è¡Œç¯å¢ƒ
    config.plugin('define').use(DefinePlugin, [
      {
        'process.env.PROJECT_NAME': JSON.stringify(process.env.PROJECT_NAME),
        'process.env.IS_STANDALONE': 'false', // è¡¨ç¤ºè¿è¡Œåœ¨èšåˆç¯å¢ƒä¸­
      },
    ]);

    // âœ… å¯é€‰ï¼šæ·»åŠ åˆ«åï¼Œæ–¹ä¾¿å­é¡¹ç›®å¼•ç”¨å…¬å…±æ¨¡å—
    config.resolve.alias
      .set('@common', path.resolve(__dirname, 'src-common')) // å…¬å…±ç»„ä»¶åº“
      .set('@utils', path.resolve(__dirname, 'src-common/utils'));
  },

  // å¯é€‰ï¼šconfigureWebpack ç”¨äºç®€å•åˆå¹¶
  configureWebpack: {
    // å¦‚æœéœ€è¦æ·»åŠ æ’ä»¶æˆ–ç®€å•é…ç½®
    // plugins: [...]
  },
};
```

- #### ğŸ“ é¡¹ç›®ç»“æ„å»ºè®®

  ```
  your-platform/
  â”œâ”€â”€ vue.config.js               # ä¸Šé¢çš„é…ç½®
  â”œâ”€â”€ package.json
  â”œâ”€â”€ public/
  â”‚   â”œâ”€â”€ model.html              # model é¡¹ç›®çš„ HTML æ¨¡æ¿
  â”‚   â”œâ”€â”€ rhea.html               # rhea é¡¹ç›®çš„ HTML æ¨¡æ¿
  â”‚   â””â”€â”€ favicon.ico
  â”œâ”€â”€ src-projects/
  â”‚   â”œâ”€â”€ model/
  â”‚   â”‚   â””â”€â”€ main.js             # Vue å®ä¾‹æŒ‚è½½ #app
  â”‚   â”œâ”€â”€ rhea/
  â”‚   â”‚   â””â”€â”€ main.js
  â”œâ”€â”€ src-common/
  â”‚   â”œâ”€â”€ components/             # å…¬å…±ç»„ä»¶
  â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
  â””â”€â”€ dist/
      â”œâ”€â”€ model/index.html        # è¾“å‡º
      â”œâ”€â”€ rhea/index.html         # è¾“å‡º
      â”œâ”€â”€ js/chunk-vendors.js     # å…¬å…±ä¾èµ–ï¼ˆvueã€vue-router ç­‰ï¼‰
      â””â”€â”€ js/chunk-common.js      # å­é¡¹ç›®å…±ç”¨ä»£ç 
  ```

- #### ğŸ§ª ä½¿ç”¨æ–¹å¼

  - ##### 1. å®‰è£…ä¾èµ–

    ```
    npm install
    ```

  - 2. ###### æ„å»ºæ‰€æœ‰é¡¹ç›®ï¼ˆçœŸæ­£çš„ä¸€æ¬¡æ„å»ºï¼‰

    ```
    npm run build
    # åªæ‰§è¡Œä¸€æ¬¡ webpackï¼Œæ„å»ºæ‰€æœ‰å…¥å£
    ```

  - ##### 3.å¼€å‘æ—¶å¯æŒ‡å®šå•ä¸ªé¡¹ç›®ï¼ˆå¯é€‰ï¼‰

    ```
    # å¦‚æœä½ æƒ³åªå¼€å‘ model
    npm run serve -- --entry src-projects/model/main.js
    ```

- ### âœ… ä¼˜åŠ¿æ€»ç»“

  | ç‰¹æ€§             | æ˜¯å¦å®ç°                             |
  | ---------------- | ------------------------------------ |
  | çœŸæ­£çš„ä¸€æ¬¡æ„å»º   | âœ… æ˜¯ï¼ˆä¸€ä¸ª webpack å®ä¾‹ï¼‰            |
  | å¤šå…¥å£ç‹¬ç«‹è¾“å‡º   | âœ… æ˜¯ï¼ˆdist/model/, dist/rhea/ï¼‰      |
  | è·¨é¡¹ç›®å…¬å…±åŒ…æå– | âœ… æ˜¯ï¼ˆchunk-vendors + chunk-commonï¼‰ |
  | æ„å»ºæ€§èƒ½ä¼˜åŒ–     | âœ… æ˜¯ï¼ˆç¼“å­˜ã€å‹ç¼©ã€tree-shakingï¼‰     |
  | æ”¯æŒå¼‚æ„ï¼Ÿ       | âŒ å¦ï¼ˆä»éœ€ç»Ÿä¸€æŠ€æœ¯æ ˆï¼‰               |
  | éƒ¨ç½²ç»Ÿä¸€         | âœ… æ˜¯ï¼ˆä¸€ä¸ª dist ç›®å½•ï¼‰               |

- ### ğŸš€ åç»­å»ºè®®

  1. **å…¬å…±ç»„ä»¶åº“**ï¼šå°† `src-common` æŠ½æˆç‹¬ç«‹ npm åŒ…ï¼Œä¾¿äºå¤ç”¨ã€‚

  2. **è‡ªåŠ¨å‘ç°é¡¹ç›®**ï¼šå¯é€šè¿‡è¯»å– `projects/` ç›®å½•è‡ªåŠ¨æ³¨å†Œå…¥å£ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤ `PROJECTS` æ•°ç»„ã€‚

  3. **æ„å»ºåˆ†æ**ï¼šæ·»åŠ  `webpack-bundle-analyzer` åˆ†æåŒ…ä½“ç§¯ã€‚

     ```
     // chainWebpack å†…æ·»åŠ 
     if (process.env.ANALYZE) {
       config.plugin('webpack-report').use(require('webpack-bundle-analyzer').BundleAnalyzerPlugin);
     }
     ```

     ```
     npm run build -- --env ANALYZE=1
     ```

### 2ã€å­é¡¹ç›®çš„æŠ€æœ¯æ ˆéƒ½æ˜¯ä¸€æ ·çš„å—ï¼Ÿè‹¥æœ‰ä¸åŒæŠ€æœ¯æ ˆçš„é¡¹ç›®ï¼Œè¿™ç§æ–¹æ¡ˆè¿˜é€‚åˆå—ï¼Ÿå¦‚æœä¸é€‚åˆæœ‰ä»€ä¹ˆåˆ«çš„æ–¹æ¡ˆï¼Ÿ 

- æœ¬é¡¹ç›®ä¸­çš„å­é¡¹ç›®æŠ€æœ¯æ ˆéƒ½æ˜¯ä¸€æ ·çš„ï¼Œvue2+webpack+vue-cli
- å½“å‰é¡¹ç›®çš„å¤–å±‚é¡¹ç›®ä¸å‚ä¸æ„å»ºï¼Œåªè´Ÿè´£ï¼š
  - åˆ†åˆ«æ‰§è¡Œ `npm run build` 
  - å°† `dist` æ‹·è´åˆ°ç»Ÿä¸€ç›®å½• 
  - æ‰“åŒ…æˆ `Docker` é•œåƒ   
- **è¿™ç§å¤–å±‚é¡¹ç›®çš„è®¾è®¡æ¨¡å¼éå¸¸é€‚åˆä¸åŒæŠ€æœ¯æ ˆçš„é¡¹ç›®**ï¼Œå®ƒæ˜¯ä¸€ç§å…¸å‹çš„â€œ**æ„å»ºåèšåˆï¼ˆ`Post-Build Aggregation`ï¼‰**â€æˆ–â€œ**ä¼ªå¼‚æ„é›†æˆ**â€ç­–ç•¥ï¼Œä¹Ÿæ˜¯ç›®å‰åœ¨å¤šæŠ€æœ¯æ ˆã€å¤šå›¢é˜Ÿåä½œçš„å¤§å‹å‰ç«¯å¹³å°ä¸­éå¸¸å¸¸è§ä¸”æ¨èçš„åšæ³•ã€‚**ä½†å½“å‰é¡¹ç›®éœ€è¦åœ¨ä¸æ”¹å˜æ€è·¯çš„æƒ…å†µä¸‹ï¼Œåšå‡ºä¸€äº›é€‚åˆä¸åŒæŠ€æœ¯æ ˆçš„æ”¹åŠ¨**

#### 2.1âœ… ä¸ºä»€ä¹ˆè¯´å®ƒé€‚åˆä¸åŒæŠ€æœ¯æ ˆï¼Ÿ

- å¤–å±‚é¡¹ç›®å®šä½éå¸¸æ¸…æ™°ï¼š**â€œä¸å‚ä¸æ„å»ºï¼Œåªè´Ÿè´£ï¼šæ‰§è¡Œæ„å»º â†’ æ‹·è´äº§ç‰© â†’ æ‰“åŒ…é•œåƒâ€**ï¼Œè¿™æ­£æ˜¯å®ç°**æŠ€æœ¯æ ˆæ— å…³æ€§**çš„å…³é”®æ‰€åœ¨ã€‚

  | èŒè´£                                 | æ˜¯å¦ä¾èµ–æŠ€æœ¯æ ˆ | è¯´æ˜                              |
  | ------------------------------------ | -------------- | --------------------------------- |
  | æ‹‰å–å­é¡¹ç›®ä»£ç ï¼ˆé¡¹ç›®ä¸åœ¨æœ¬åœ°æ—¶éœ€è¦ï¼‰ | âŒ å¦           | `Git` æ“ä½œï¼Œä¸æŠ€æœ¯æ— å…³            |
  | æ‰§è¡Œ `npm run build`                 | âš ï¸ æœ‰é™ä¾èµ–     | åªè¦å­é¡¹ç›®æœ‰è¿™ä¸ª scriptï¼Œå°±èƒ½è¿è¡Œ |
  | æ‹·è´ `dist` ç›®å½•                     | âŒ å¦           | æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œé€šç”¨                |
  | æ‰“åŒ… `Docker` é•œåƒ                   | âŒ å¦           | å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¸å†…å®¹æ— å…³            |

  

- ğŸ‘‰ æ‰€ä»¥åªè¦**å„å­é¡¹ç›®èƒ½ç‹¬ç«‹å®Œæˆè‡ªå·±çš„æ„å»ºå¹¶è¾“å‡ºæ ‡å‡†é™æ€èµ„æº**ï¼Œæ— è®ºå®ƒæ˜¯ `Vue`ã€`React`ã€`Angular`ã€`Svelte`ã€åŸç”Ÿ `JS`ï¼Œç”šè‡³åç«¯æ¸²æŸ“çš„ `HTML` é¡µé¢ï¼Œéƒ½å¯ä»¥è¢«è¿™ä¸ªå¤–å±‚æµç¨‹ç»Ÿä¸€èšåˆã€‚

  

- #### æ”¯æŒå¼‚æ„çš„æŠ€æœ¯æ ˆç¤ºä¾‹

  | å­é¡¹ç›®   | æŠ€æœ¯æ ˆ             | æ„å»ºå‘½ä»¤                              | è¾“å‡ºç›®å½•          | æ˜¯å¦æ”¯æŒ |
  | -------- | ------------------ | ------------------------------------- | ----------------- | -------- |
  | `model`  | `Vue 3 + Vite`     | `vite build`                          | `dist/`           | âœ…        |
  | `rhea`   | `React + CRA`      | `react-scripts build`                 | `build/`          | âœ…        |
  | `admin`  | `Angular`          | `ng build --configuration=production` | `dist/admin`      | âœ…        |
  | `docs`   | `VitePress`        | `vitepress build`                     | `.vitepress/dist` | âœ…        |
  | `legacy` | `jQuery + Webpack` | `webpack --mode production`           | `public/`         | âœ…        |

  - åªè¦è¿™äº›é¡¹ç›®éƒ½æä¾›äº† `npm run build` è„šæœ¬ï¼Œå¹¶ä¸”æ„å»ºåç”Ÿæˆçš„æ˜¯å¯éƒ¨ç½²çš„ `HTML/CSS/JS` é™æ€æ–‡ä»¶ï¼Œ**ä½ çš„å¤–å±‚èšåˆæµç¨‹å°±èƒ½ä¸€è§†åŒä»åœ°å¤„ç†å®ƒä»¬**ã€‚

#### 2.2âœ… å®ç°â€œè·¨æŠ€æœ¯æ ˆèšåˆâ€çš„å…³é”®å‰æ

- ä¸ºäº†è®©è¿™ç§æ¨¡å¼é¡ºåˆ©è¿è¡Œï¼Œä½ éœ€è¦åœ¨å›¢é˜Ÿæˆ–ç»„ç»‡å±‚é¢çº¦å®šä¸€äº›**æ ‡å‡†åŒ–è§„èŒƒ**ï¼š

  - **ï¼ˆ1ï¼‰ç»Ÿä¸€æ„å»ºè„šæœ¬å‘½å**

    ```
    // æ‰€æœ‰å­é¡¹ç›® package.json
    {
      "scripts": {
        "build": "xxx"  // å¿…é¡»å­˜åœ¨ä¸”èƒ½è¾“å‡ºç”Ÿäº§ç¯å¢ƒèµ„æº
      }
    }
    ```

    - âœ… æ”¯æŒä¸åŒå·¥å…·ï¼š`vite build` / `react-scripts build` / `ng build` ç­‰éƒ½å¯ä»¥å°è£…åœ¨ `build` è„šæœ¬é‡Œã€‚

  - **ï¼ˆ2ï¼‰è¾“å‡ºè·¯å¾„å¯é¢„æµ‹æˆ–å¯é…ç½®**

    - å»ºè®®é€šè¿‡æ„å»ºé…ç½®æŒ‡å®šè¾“å‡ºç›®å½•ï¼Œä¾¿äºå¤–å±‚è„šæœ¬ç»Ÿä¸€ç®¡ç†ã€‚
    - ç¤ºä¾‹ï¼š
      - Vue/Vite: `build.outDir = '../aggregator/dist/model'`
      - React/CRA: `"homepage": "./"` + å¤–å±‚ç§»åŠ¨ `build/` åˆ° `dist/rhea/`

  - **ï¼ˆ3ï¼‰åŸºç¡€è·¯å¾„ï¼ˆBase Pathï¼‰è®¾ç½®æ­£ç¡®**

    - ç¡®ä¿æ¯ä¸ªé¡¹ç›®çŸ¥é“è‡ªå·±çš„éƒ¨ç½²è·¯å¾„ï¼Œé¿å…èµ„æº 404ï¼š
      - Vue: `base: '/model/'`
      - React: `"homepage": "/rhea/"`
      - Angular: `--base-href=/admin/`

  -  **ï¼ˆ4ï¼‰å¤–å±‚è„šæœ¬è‡ªåŠ¨åŒ–å¤„ç†**

    ```
    # ç¤ºä¾‹ï¼šbuild-aggregate.sh
    git clone https://git/model && cd model && npm run build
    cp -r dist ../aggregator/dist/model
    
    git clone https://git/rhea && cd rhea && npm run build  
    cp -r build ../aggregator/dist/rhea
    
    docker build -t my-platform:latest ../aggregator
    ```

### 2.3âœ… ä¼˜åŠ¿æ€»ç»“ï¼ˆä¸ºä»€ä¹ˆæ¨èï¼‰

| ä¼˜åŠ¿                  | è¯´æ˜                                             |
| --------------------- | ------------------------------------------------ |
| ğŸŒ **æŠ€æœ¯æ ˆè‡ªç”±**      | å„å›¢é˜Ÿå¯è‡ªç”±é€‰æ‹©æŠ€æœ¯ï¼Œä¸å—ä¸­å¤®æ„å»ºç³»ç»Ÿé™åˆ¶       |
| ğŸ”§ **æ„å»ºéš”ç¦»**        | ä¸€ä¸ªé¡¹ç›®æ„å»ºå¤±è´¥ä¸å½±å“å…¶ä»–é¡¹ç›®                   |
| ğŸš€ **éƒ¨ç½²ç»Ÿä¸€**        | ä¸€æ¬¡ CI æµç¨‹å®Œæˆæ‰€æœ‰é¡¹ç›®ä¸Šçº¿ï¼Œè¿ç»´ç®€å•           |
| ğŸ“¦ **å¯å®¹å™¨åŒ–**        | æœ€ç»ˆæ‰“åŒ…æˆä¸€ä¸ª Docker é•œåƒï¼Œé€‚åˆ Kubernetes éƒ¨ç½² |
| ğŸ”„ **æ˜“äº CI/CD é›†æˆ** | å¯è½»æ¾æ¥å…¥ GitLab CIã€GitHub Actionsã€Jenkins ç­‰ |

### 2.4âš ï¸ æ³¨æ„äº‹é¡¹ï¼ˆå±€é™æ€§ï¼‰

| é—®é¢˜           | è¯´æ˜                                               |
| -------------- | -------------------------------------------------- |
| âŒ æ— æ³•å…±äº«ä»£ç  | ä¸èƒ½è·¨é¡¹ç›®åš `splitChunks` æå–å…¬å…±åŒ…ï¼ˆå¦‚ lodashï¼‰ |
| âŒ æ— æ³•çƒ­æ›´æ–°   | æ¯ä¸ªé¡¹ç›®ç‹¬ç«‹æ„å»ºï¼Œæ— æ³•å®ç°æ¨¡å—è”é‚¦å¼åŠ¨æ€åŠ è½½       |
| âŒ æ„å»ºæ•ˆç‡ä½   | å¤šä¸ªé¡¹ç›®ä¸²è¡Œ/å¹¶è¡Œæ„å»ºï¼Œæ€»æ—¶é—´è¾ƒé•¿                  |
| âŒ è°ƒè¯•å¤æ‚     | æœ¬åœ°å¼€å‘éœ€åˆ†åˆ«å¯åŠ¨å¤šä¸ªæœåŠ¡                         |

- ğŸ’¡ å¦‚æœæœªæ¥éœ€è¦æ›´æ·±åº¦é›†æˆï¼ˆå¦‚å…±äº«ç»„ä»¶ã€çŠ¶æ€é€šä¿¡ï¼‰ï¼Œå»ºè®®æ¼”è¿›åˆ° **å¾®å‰ç«¯ï¼ˆqiankunï¼‰** æˆ– **Module Federation**ã€‚

### 2.5âœ… ç»“è®º

- è¿™æ˜¯ä¸€ç§**æ¾è€¦åˆã€é«˜è‡ªç”±åº¦ã€æ˜“ç»´æŠ¤**çš„å·¥ç¨‹æ¶æ„æ¨¡å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºï¼š
  - å¤šå›¢é˜Ÿåä½œçš„ä¸­åå°å¹³å°
  - å†å²é¡¹ç›®é€æ­¥è¿ç§»
  - æŠ€æœ¯é€‰å‹å¤šæ ·åŒ–çš„å¤§å‹ç³»ç»Ÿ
  - éœ€è¦ç»Ÿä¸€éƒ¨ç½²èŠ‚å¥ä½†ä¿æŒæŠ€æœ¯ç‹¬ç«‹æ€§çš„åœºæ™¯

- åªè¦åšå¥½**è¾“å‡ºæ ‡å‡†åŒ–**å’Œ**æµç¨‹è‡ªåŠ¨åŒ–**ï¼Œè¿™å¥—æ–¹æ¡ˆå¯ä»¥ç¨³å®šæ”¯æ’‘å¤šç§æŠ€æœ¯æ ˆå…±å­˜çš„å¤æ‚å‰ç«¯ä½“ç³»ã€‚

#### 2.6ã€åŸºäºå½“å‰é¡¹ç›®è¦æ”¯æŒä¸åŒæŠ€æœ¯æ ˆéœ€è¦åšçš„æ”¹åŠ¨

**2.6.1å½“å‰çš„æœ€å¤–å±‚é¡¹ç›®æ˜¯Vueé¡¹ç›®ï¼Œæ„å»ºé€»è¾‘å†™åœ¨ `vue.config.js` ä¸­**

| é—®é¢˜                           | è¯´æ˜                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| **1. æ··æ·†é¡¹ç›®èŒè´£**            | `vue.config.js` æ˜¯ **æ„å»ºé…ç½®æ–‡ä»¶**ï¼Œä¸æ˜¯ **æ„å»ºè°ƒåº¦è„šæœ¬**ã€‚å®ƒåº”è¯¥æè¿°â€œå¦‚ä½•æ„å»ºå½“å‰é¡¹ç›®â€ï¼Œè€Œä¸æ˜¯â€œå»æ„å»ºåˆ«äººâ€ã€‚ |
| **2. æ„å»ºå‰¯ä½œç”¨ä¸å¯æ§**        | å¦‚æœæ„å»ºå¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¼šæ··åœ¨ `Vue` æ„å»ºæ—¥å¿—ä¸­ï¼Œéš¾ä»¥å®šä½ã€‚ä¸” `configureWebpack` ä¸æ˜¯è®¾è®¡æ¥æ‰§è¡Œå‰¯ä½œç”¨çš„ã€‚ |
| **3. æ— æ³•ç‹¬ç«‹è¿è¡Œ**            | ä½ ä¸èƒ½å•ç‹¬è¿è¡Œâ€œæ„å»º `model`â€æˆ–â€œæ„å»º `rhea`â€ï¼Œå¿…é¡»èµ°å®Œæ•´ `Vue` æ„å»ºæµç¨‹ã€‚ |
| **4. ä¸ `CI/CD` è€¦åˆ**         | åœ¨ `CI` ç¯å¢ƒä¸­ï¼Œå¦‚æœåªæƒ³æ„å»ºæŸä¸ªå­é¡¹ç›®ï¼Œä½ å¿…é¡»è¿è¡Œæ•´ä¸ªå¤–å±‚ `Vue` æ„å»ºï¼Œæ•ˆç‡ä½ä¸‹ã€‚ |
| **5. éš¾ä»¥æµ‹è¯•å’Œè°ƒè¯•**          | é€»è¾‘è—åœ¨é…ç½®æ–‡ä»¶é‡Œï¼Œæ–°äººçœ‹ä¸æ‡‚ï¼Œä¹Ÿæ— æ³•å•ç‹¬æµ‹è¯•æ„å»ºæµç¨‹ã€‚     |
| **6. ä¾èµ– `Vue CLI` ç”Ÿå‘½å‘¨æœŸ** | ä¸€æ—¦ä½ æ¢åˆ° `Vite` æˆ–å…¶ä»–å·¥å…·ï¼Œ`vue.config.js` å°±å¤±æ•ˆäº†ã€‚     |

**2.6.2âŒ ä¸ºä»€ä¹ˆä¸èƒ½ï¼ˆä¸åº”è¯¥ï¼‰æŠŠæ„å»ºé€»è¾‘å†™åœ¨ `vue.config.js` ä¸­ï¼Ÿ**

- ####  **ï¼ˆ1ï¼‰`vue.config.js` çš„è®¾è®¡ç›®çš„**

  - å®ƒæ˜¯**Vue CLI çš„é…ç½®æ–‡ä»¶**ï¼Œç”¨äºé…ç½®ï¼š
    - webpack
    - devServer
    - publicPath
    - æ„å»ºè¾“å‡ºè·¯å¾„
    - æ’ä»¶ç­‰
  - å®ƒçš„ä½œç”¨èŒƒå›´ä»…é™äº **å½“å‰ Vue é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹**ã€‚
  - å®ƒ**ä¸æ˜¯è„šæœ¬æ‰§è¡Œå…¥å£**ï¼Œä¸èƒ½ç”¨æ¥æ‹‰ä»£ç ã€æ‰§è¡Œ shell å‘½ä»¤ã€è°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ„å»ºã€‚

- **ï¼ˆ2ï¼‰æ— æ³•å®Œæˆâ€œæ‹‰å–ä»£ç  + æ‰§è¡Œ build + æ‹·è´â€ç­‰æ“ä½œ**

  - `vue.config.js` æ˜¯ä¸€ä¸ª JS æ¨¡å—ï¼Œä¸æ˜¯å¯æ‰§è¡Œè„šæœ¬ã€‚ä½ ä¸èƒ½åœ¨é‡Œé¢å†™ï¼š

    ```
    // âŒ è¿™ç§ä»£ç åœ¨ vue.config.js ä¸­æ— æ³•è¿è¡Œï¼
    require('child_process').execSync('git clone https://xxx/model');
    require('child_process').execSync('npm run build', { cwd: 'model' });
    ```

    - å³ä½¿ä½ å¼ºè¡Œè¿™ä¹ˆåšï¼š
      - å®ƒåªä¼šåœ¨ **Vue é¡¹ç›®è‡ªèº«æ„å»ºæ—¶è§¦å‘ä¸€æ¬¡**ï¼Œä¸å¯æ§ã€‚
      - æ„å»ºå¤±è´¥ä¼šæ±¡æŸ“å½“å‰é¡¹ç›®çš„æ„å»ºæµç¨‹ã€‚
      - éš¾ä»¥è°ƒè¯•ã€æ— æ³•ç‹¬ç«‹è¿è¡Œã€ä¸ç¬¦åˆ CI/CD è§„èŒƒã€‚

- **ï¼ˆ3ï¼‰èŒè´£æ··ä¹±**

  - ä¸€ä¸ªé¡¹ç›®æ—¢æ˜¯â€œå‰ç«¯åº”ç”¨â€åˆæ˜¯â€œæ„å»ºè°ƒåº¦å™¨â€ï¼Œä¼šå¯¼è‡´ï¼š
    - å…¶ä»–å¼€å‘è€…è¯¯è§£é¡¹ç›®ç”¨é€”
    - éƒ¨ç½²æ—¶ä¸çŸ¥é“è¯¥ serve å“ªä¸ªåº”ç”¨
    - CI/CD æµç¨‹å¤æ‚åŒ–ï¼ˆåˆ°åº•æ˜¯ build è‡ªèº«ï¼Ÿè¿˜æ˜¯ build åˆ«äººï¼Ÿï¼‰

**2.6.3âœ… æ­£ç¡®åšæ³•ï¼šå¤–å±‚é¡¹ç›®å¯ä»¥æ˜¯ Vue é¡¹ç›®ç»“æ„ï¼Œä½†ä¸è¦å‚ä¸å‰ç«¯é€»è¾‘**

- å¦‚æœä½ åšæŒæƒ³ç”¨ Vue é¡¹ç›®ä½œä¸ºå¤–å±‚é¡¹ç›®ï¼ˆæ¯”å¦‚ä¸ºäº†åˆ©ç”¨ `package.json` æˆ– `npm scripts`ï¼‰ï¼Œå¯ä»¥è¿™æ ·åšï¼š

- **æ¨èç»“æ„ï¼ˆåä¹‰ä¸Šæ˜¯ Vue é¡¹ç›®ï¼Œå®é™…æ˜¯å·¥å…·é¡¹ç›®ï¼‰**

  ```
  aggregator/                 # åä¹‰ä¸Šçš„ Vue é¡¹ç›®
  â”œâ”€â”€ package.json
  â”œâ”€â”€ vue.config.js           # å­˜åœ¨ä½†ä¸ºç©ºæˆ–ä»…ç”¨äºè®¾ç½®è¾“å‡ºè·¯å¾„
  â”œâ”€â”€ build.sh                # âœ… çœŸæ­£çš„æ„å»ºé€»è¾‘åœ¨è¿™é‡Œ
  â”œâ”€â”€ deploy.yml              # å¯é€‰ï¼šéƒ¨ç½²é…ç½®
  â”œâ”€â”€ dist/
  â”‚   â”œâ”€â”€ model/              # å­é¡¹ç›®æ„å»ºäº§ç‰©
  â”‚   â”œâ”€â”€ rhea/
  â”‚   â””â”€â”€ ...
  â””â”€â”€ README.md
  ```

- âœ… **`package.json` ç¤ºä¾‹**

  ```
  {
    "name": "aggregator",
    "scripts": {
      "build": "sh build.sh",           # âœ… è°ƒç”¨å¤–éƒ¨è„šæœ¬
      "build:model": "cd ../model && npm run build",
      "build:rhea": "cd ../rhea && npm run build"
    }
  }
  ```

- **âœ… `build.sh` ç¤ºä¾‹ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰**

  ```
  #!/bin/bash
  set -e
  
  echo "ğŸš€ å¼€å§‹èšåˆæ„å»º"
  
  # æ¸…ç†
  rm -rf dist/* && mkdir -p dist
  
  # æ‹‰å–å¹¶æ„å»º model (Vue)
  git clone https://git/model.git temp/model
  cd temp/model && npm ci && npm run build
  cp -r dist ../aggregator/dist/model
  
  # æ‹‰å–å¹¶æ„å»º rhea (React)
  git clone https://git/rhea.git temp/rhea
  cd temp/rhea && npm ci && npm run build
  cp -r build ../aggregator/dist/rhea
  
  # æ„å»º Docker é•œåƒ
  docker build -t my-platform:latest .
  ```

- âœ… `vue.config.js`ï¼ˆå¯æœ‰å¯æ— ï¼‰

  ```
  // å¯ä»¥ç•™ç©ºï¼Œæˆ–ä»…ç”¨äºè®¾ç½®èšåˆåçš„è¾“å‡ºè·¯å¾„ï¼ˆéå¿…é¡»ï¼‰
  module.exports = {
    outputDir: 'dist',  // å¦‚æœä½ çœŸæƒ³ç”¨ Vue CLI æ„å»ºæŸä¸ªå£³é¡µé¢
    publicPath: '/'
  }
  ```

  - âš ï¸ æ³¨æ„ï¼šé™¤éä½ çœŸçš„æƒ³åœ¨èšåˆé¡µé¢ä¸ŠåŠ ä¸€ä¸ªå¯¼èˆªé¦–é¡µï¼Œå¦åˆ™è¿ `vue.config.js` éƒ½ä¸éœ€è¦ã€‚

**2.6.4âœ… æ›´ä½³å®è·µï¼šå¤–å±‚é¡¹ç›®æ ¹æœ¬ä¸éœ€è¦æ˜¯ Vue é¡¹ç›®**

- å»ºè®®ç›´æ¥ä½¿ç”¨ä¸€ä¸ª**è½»é‡çº§ Node.js è„šæœ¬é¡¹ç›®**æˆ–**çº¯ Shell è„šæœ¬é¡¹ç›®**ï¼š

  ```
  aggregator/
  â”œâ”€â”€ build.js               # ç”¨ Node.js å†™ç¼–æ’é€»è¾‘ï¼ˆæ¨èï¼‰
  â”œâ”€â”€ build.sh               # æˆ–ç”¨ Shell
  â”œâ”€â”€ Dockerfile             # Docker é•œåƒæ„å»ºæ–‡ä»¶
  â”œâ”€â”€ nginx.conf             # Nginx é…ç½®ç¤ºä¾‹
  â”œâ”€â”€ .gitlab-ci.yml         # GitLab CI é…ç½®
  â”œâ”€â”€ package.json           # ç”¨äºç®¡ç†ä¾èµ–åŠè„šæœ¬å‘½ä»¤
  â”œâ”€â”€ dist/                  # è¾“å‡ºç›®å½•
  â”‚   â”œâ”€â”€ model/             # Vue é¡¹ç›®çš„è¾“å‡º
  â”‚   â””â”€â”€ rhea/              # React é¡¹ç›®çš„è¾“å‡º
  â””â”€â”€ README.md              # æ–‡æ¡£è¯´æ˜
  ```

  **1. `build.sh`æˆ– `build.js`æ„å»ºè„šæœ¬**

  - è¿™æ˜¯ä¸€ä¸ª bash è„šæœ¬ï¼Œç”¨æ¥æ‰§è¡Œå„ä¸ªå­é¡¹ç›®çš„æ„å»ºï¼Œå¹¶å°†å®ƒä»¬çš„è¾“å‡ºæ”¶é›†åˆ° `dist/` ç›®å½•ä¸­ã€‚

  ```
  #!/bin/bash
  
  # è®¾ç½®é”™è¯¯ç«‹å³é€€å‡º
  set -e
  
  # æ¸…ç†ä¹‹å‰çš„æ„å»ºäº§ç‰©
  echo "æ¸…ç†ä¹‹å‰çš„æ„å»ºäº§ç‰©..."
  rm -rf dist/*
  
  # æ„å»º Vue é¡¹ç›® (model)
  echo "å¼€å§‹æ„å»º Vue é¡¹ç›® (model)..."
  cd ../model && npm ci && npm run build
  echo "Vue é¡¹ç›®æ„å»ºå®Œæˆ."
  
  # æ„å»º React é¡¹ç›® (rhea)
  echo "å¼€å§‹æ„å»º React é¡¹ç›® (rhea)..."
  cd ../rhea && npm ci && npm run build
  echo "React é¡¹ç›®æ„å»ºå®Œæˆ."
  
  # å¦‚æœæœ‰å…¶ä»–é¡¹ç›®ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤...
  
  # å¤åˆ¶å…¬å…±èµ„æºï¼ˆå¦‚ favicon.icoï¼‰
  echo "å¤åˆ¶å…¬å…±èµ„æº..."
  cp ../model/public/favicon.ico dist/
  
  echo "æ‰€æœ‰é¡¹ç›®æ„å»ºå®Œæˆï¼"
  ```

  ```
  // build.js
  const { execSync } = require('child_process');
  const fs = require('fs');
  
  function run(cmd, cwd) {
    execSync(cmd, { cwd, stdio: 'inherit' });
  }
  
  // æ„å»º model
  run('git clone https://git/model.git model', 'temp');
  run('npm ci && npm run build', 'temp/model');
  fs.cpSync('temp/model/dist', 'dist/model', { recursive: true });
  
  // æ„å»º rhea
  run('git clone https://git/rhea.git rhea', 'temp');
  run('npm ci && npm run build', 'temp/rhea');
  fs.cpSync('temp/rhea/build', 'dist/rhea', { recursive: true });
  
  // æ„å»ºé•œåƒ
  run('docker build -t my-platform:latest .');
  ```

- **æ³¨æ„äº‹é¡¹ï¼š**
  - ä½¿ç”¨ `npm ci` æ¥ç¡®ä¿å®‰è£…çš„ä¾èµ–ä¸ `package-lock.json` æˆ– `yarn.lock` ä¸€è‡´ã€‚
  - ç¡®ä¿æ¯ä¸ªå­é¡¹ç›®çš„ `vue.config.js` æˆ– `craco.config.js` å·²ç»è®¾ç½®å¥½è¾“å‡ºè·¯å¾„å’Œ `publicPath`ã€‚

**2. `Dockerfile` - `Docker` é•œåƒæ„å»ºæ–‡ä»¶**

- å‡è®¾ä½ å¸Œæœ›å°†æ•´ä¸ªæ„å»ºç»“æœæ‰“åŒ…æˆä¸€ä¸ª Docker é•œåƒè¿›è¡Œéƒ¨ç½²ï¼š

  ```
  # ä½¿ç”¨å®˜æ–¹ Nginx åŸºç¡€é•œåƒ
  FROM nginx:alpine
  
  # ç§»é™¤é»˜è®¤çš„ Nginx é…ç½®
  RUN rm /etc/nginx/conf.d/default.conf
  
  # æ‹·è´è‡ªå®šä¹‰çš„ Nginx é…ç½®
  COPY nginx.conf /etc/nginx/conf.d
  
  # æ‹·è´æ„å»ºåçš„é™æ€èµ„æº
  COPY dist /usr/share/nginx/html
  
  # æš´éœ² 80 ç«¯å£
  EXPOSE 80
  
  # å¯åŠ¨ Nginx
  CMD ["nginx", "-g", "daemon off;"]
  ```

**3. `nginx.conf` - `Nginx` é…ç½®ç¤ºä¾‹**

- ä¸ºäº†æ­£ç¡®åœ°æœåŠ¡ä¸åŒè·¯å¾„ä¸‹çš„åº”ç”¨ï¼Œéœ€è¦å¯¹ Nginx è¿›è¡Œé€‚å½“çš„é…ç½®ï¼š

  ```
  server {
      listen 80;
      server_name your-platform.com;
  
      location /model/ {
          alias /usr/share/nginx/html/model/;
          try_files $uri $uri/ /model/index.html;
      }
  
      location /rhea/ {
          alias /usr/share/nginx/html/rhea/;
          try_files $uri $uri/ /rhea/index.html;
      }
  
      location /favicon.ico {
          alias /usr/share/nginx/html/favicon.ico;
      }
  }
  ```

**4. `.gitlab-ci.yml` - GitLab CI é…ç½®**

- å¦‚æœä½ ä½¿ç”¨ GitLab CI æ¥å®ç°æŒç»­é›†æˆå’Œéƒ¨ç½²ï¼Œå¯ä»¥åˆ›å»ºå¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼š

  ```
  stages:
    - build
    - deploy
  
  build:
    stage: build
    script:
      - ./build.sh
    artifacts:
      paths:
        - dist/
  
  deploy:
    stage: deploy
    script:
      - docker build -t your-docker-repo/your-app .
      - docker push your-docker-repo/your-app
    only:
      - main
  ```

**5. `package.json` - ç”¨äºç®¡ç†ä¾èµ–åŠè„šæœ¬å‘½ä»¤**

- è™½ç„¶æœ€å¤–å±‚é¡¹ç›®ä¸éœ€è¦å¾ˆå¤šä¾èµ–ï¼Œä½†ä½ å¯ä»¥åœ¨è¿™é‡Œå®šä¹‰ä¸€äº›æœ‰ç”¨çš„å‘½ä»¤ï¼Œæ¯”å¦‚è¿è¡Œæ„å»ºè„šæœ¬ï¼š

  ```
  {
    "name": "aggregator",
    "version": "1.0.0",
    "description": "Aggregator for multiple frontend projects",
    "scripts": {
      "build": "./build.sh",
      "docker-build": "docker build -t your-docker-repo/your-app ."
    },
    "devDependencies": {}
  }
  ```

**2.6.5ã€æ€»ç»“**

| é—®é¢˜                                        | å›ç­”                                                         |
| ------------------------------------------- | ------------------------------------------------------------ |
| **å¤–å±‚é¡¹ç›®å¯ä»¥æ˜¯ Vue é¡¹ç›®å—ï¼Ÿ**             | âœ… å¯ä»¥ï¼Œä½†**ä»…é™åä¹‰ä¸Š**ï¼Œä¸åº”æœ‰çœŸå®å‰ç«¯åŠŸèƒ½                 |
| **èƒ½æŠŠæ„å»ºé€»è¾‘å†™åœ¨ `vue.config.js` ä¸­å—ï¼Ÿ** | âŒ **ç»å¯¹ä¸è¡Œ**ï¼Œå®ƒä¸æ˜¯æ‰§è¡Œè„šæœ¬çš„åœ°æ–¹                         |
| **æ­£ç¡®åšæ³•æ˜¯ä»€ä¹ˆï¼Ÿ**                        | âœ… å°†æ„å»ºé€»è¾‘å†™åœ¨ `build.sh` æˆ– `build.js` ä¸­ï¼Œé€šè¿‡ `npm run build` è°ƒç”¨ |
| **æœ€ä½³æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ**                        | âœ… å¤–å±‚æ˜¯ä¸€ä¸ª**å·¥å…·å‹é¡¹ç›®**ï¼Œä¸ä¾èµ–ä»»ä½•å‰ç«¯æ¡†æ¶ï¼Œåªè´Ÿè´£ç¼–æ’   |

- ğŸ’¡ **è®°ä½ï¼šå·¥å…·çš„èŒè´£æ˜¯â€œè°ƒåº¦â€ï¼Œä¸æ˜¯â€œæ¸²æŸ“â€ã€‚ä¸è¦è®©ä¸€ä¸ªå‰ç«¯é¡¹ç›®å»å¹² CI/CD å·¥å…·çš„æ´»ã€‚**

- å¦‚æœä½ éœ€è¦ä¸€ä¸ªç»Ÿä¸€å…¥å£é¡µé¢ï¼ˆå¦‚å¯¼èˆªé¦–é¡µï¼‰ï¼Œå¯ä»¥å•ç‹¬æ„å»ºä¸€ä¸ªæç®€çš„ Vue é¡µé¢ï¼Œå†å’Œå…¶ä»–å­é¡¹ç›®ä¸€èµ·èšåˆï¼Œè€Œä¸æ˜¯è®©â€œæ„å»ºè°ƒåº¦å™¨â€æœ¬èº«æˆä¸ºä¸€ä¸ªå‰ç«¯åº”ç”¨ã€‚

**2.6.6ã€å…³äºnpm i** 

- å‡è®¾ä½ çš„æœ€å¤–å±‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

  ```
  aggregator/
  â”œâ”€â”€ package.json        â† åªåŒ…å«è‡ªå·±çš„ä¾èµ–ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰
  â”œâ”€â”€ build.sh
  â””â”€â”€ dist/
  ```

- å½“ä½ è¿è¡Œï¼š

  ```
  å½“ä½ è¿è¡Œï¼š
  ```

- å®ƒåªä¼šæ£€æŸ¥ `aggregator/package.json`ï¼Œå¹¶å®‰è£…å…¶ä¸­åˆ—å‡ºçš„ä¾èµ–ã€‚

- **âœ… æ­£ç¡®åšæ³•ï¼šåœ¨æ¯ä¸ªå­é¡¹ç›®ä¸­ç‹¬ç«‹æ‰§è¡Œ `npm i`**

- #### âœ… æ¨èæ–¹å¼ï¼šåœ¨æ„å»ºè„šæœ¬ä¸­å®Œæˆï¼ˆå¦‚ `build.sh`ï¼‰

  ```
  #!/bin/bash
  set -e
  
  echo "ğŸš€ å¼€å§‹èšåˆæ„å»º"
  
  rm -rf dist/* temp/
  mkdir -p dist temp
  
  # æ„å»º model (Vue é¡¹ç›®)
  echo "ğŸ“¥ æ‹‰å– model é¡¹ç›®"
  git clone https://your-git/model.git temp/model
  
  echo "ğŸ“¦ å®‰è£… model ä¾èµ–"
  cd temp/model && npm ci  # æ¨èä½¿ç”¨ npm ci è€Œä¸æ˜¯ npm i
  
  echo "ğŸ”¨ æ„å»º model"
  npm run build
  
  echo "ğŸ“ å¤åˆ¶æ„å»ºäº§ç‰©"
  cp -r dist ../aggregator/dist/model
  
  
  # æ„å»º rhea (React é¡¹ç›®)
  echo "ğŸ“¥ æ‹‰å– rhea é¡¹ç›®"
  git clone https://your-git/rhea.git temp/rhea
  
  echo "ğŸ“¦ å®‰è£… rhea ä¾èµ–"
  cd temp/rhea && npm ci
  
  echo "ğŸ”¨ æ„å»º rhea"
  npm run build
  
  echo "ğŸ“ å¤åˆ¶æ„å»ºäº§ç‰©"
  cp -r build ../aggregator/dist/rhea
  
  
  # æœ€åæ„å»º Docker é•œåƒ
  docker build -t my-platform:latest .
  ```

  - ğŸ”‘ å…³é”®ç‚¹ï¼š`npm ci` æˆ– `npm install` æ˜¯åœ¨ `temp/model` å’Œ `temp/rhea` ç›®å½•ä¸­æ‰§è¡Œçš„ï¼Œä¸æ˜¯åœ¨æœ€å¤–å±‚ã€‚

- ### âœ… æ›´å¥½çš„å®è·µå»ºè®®

  - **1ã€ä½¿ç”¨ `npm ci` è€Œä¸æ˜¯ `npm i`**
    - `npm ci` æ›´å¿«ã€æ›´å¯é ï¼Œè¦æ±‚ `package-lock.json` å­˜åœ¨ã€‚
    - é€‚åˆ CI/CD ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬ä¸€è‡´ã€‚

  - **2ã€å¯é€‰ï¼šåœ¨æœ€å¤–å±‚ `package.json` ä¸­å®šä¹‰è„šæœ¬ï¼Œè°ƒç”¨å­é¡¹ç›®å®‰è£…**

    ```
    {
      "scripts": {
        "setup:model": "cd ../model && npm ci",
        "setup:rhea": "cd ../rhea && npm ci",
        "setup:all": "npm run setup:model && npm run setup:rhea"
      }
    }
    ```

  - ä½†è¿™è¦æ±‚å­é¡¹ç›®**å·²ç»å­˜åœ¨äºæœ¬åœ°è·¯å¾„**ï¼ˆå¦‚ monorepo ç»“æ„ï¼‰ï¼Œä¸é€‚åˆä» Git åŠ¨æ€æ‹‰å–çš„åœºæ™¯ã€‚

- ### âŒ å¸¸è§è¯¯è§£æ¾„æ¸…

  | è¯¯è§£                                        | è¯´æ˜                                                         |
  | ------------------------------------------- | ------------------------------------------------------------ |
  | â€œnpm å¯ä»¥é€’å½’å®‰è£…æ‰€æœ‰å­ç›®å½•çš„ package.jsonâ€ | âŒ `npm` ä¸ä¼šè‡ªåŠ¨æ‰«æå­ç›®å½•ï¼Œé™¤éä½¿ç”¨ `lerna` æˆ– `npm workspaces` |
  | â€œæˆ‘å¯ä»¥æŠŠæ‰€æœ‰ä¾èµ–å†™åœ¨æœ€å¤–å±‚ package.jsonâ€   | âŒ è¿™ä¼šå¯¼è‡´ä¾èµ–æ··ä¹±ã€ç‰ˆæœ¬å†²çªã€ä½“ç§¯è†¨èƒ€ï¼Œå®Œå…¨è¿èƒŒæ¨¡å—åŒ–åŸåˆ™   |
  | â€œç”¨ `npm i` ä¸€æ¬¡è£…å®Œæ›´å¿«â€                   | âŒ ä¸ç°å®ï¼Œä¹Ÿæ— æ³•ä¿è¯å„é¡¹ç›®ä¾èµ–éš”ç¦»                           |

- ### âœ… æ›¿ä»£æ–¹æ¡ˆï¼ˆæ›´é«˜çº§ï¼‰

  - å¦‚æœä½ å¸Œæœ›æ›´é«˜æ•ˆåœ°ç®¡ç†å¤šé¡¹ç›®ä¾èµ–ï¼Œå¯ä»¥è€ƒè™‘ï¼š
    - **1. `Monorepo + npm/yarn/pnpm workspaces`**
      - æ‰€æœ‰é¡¹ç›®åœ¨åŒä¸€ä¸ªä»“åº“ä¸­
      - æ”¯æŒç»Ÿä¸€å®‰è£…ä¾èµ–ï¼ˆ`npm install` åœ¨æ ¹ç›®å½•è¿è¡Œï¼‰
      - é€‚åˆå›¢é˜Ÿåä½œç´§å¯†ã€æŠ€æœ¯æ ˆè¾ƒç»Ÿä¸€çš„åœºæ™¯
    -  **2ã€ä½¿ç”¨ PNPM + Hooks**
      - PNPM æ”¯æŒé€šè¿‡ `setup` é’©å­è‡ªåŠ¨å®‰è£…å­é¡¹ç›®ä¾èµ–
      - æ›´é€‚åˆå¤§è§„æ¨¡å·¥ç¨‹ä½“ç³»
  - ä½†è¿™äº›éƒ½ä¸é€‚ç”¨äºâ€œåŠ¨æ€æ‹‰å–è¿œç¨‹å­é¡¹ç›®â€çš„åœºæ™¯ã€‚
  - å¤–å±‚é¡¹ç›®åªæ˜¯ä¸€ä¸ªâ€œæŒ‡æŒ¥å®˜â€ï¼Œå®ƒè¦åšçš„ä¸æ˜¯è‡ªå·±å®‰è£…ï¼Œè€Œæ˜¯â€œå‘½ä»¤æ¯ä¸ªå­é¡¹ç›®å®‰è£…è‡ªå·±çš„ä¾èµ–â€ã€‚

#### 2.7ã€ğŸ†š å¯¹æ¯”ï¼šçœŸæ­£çš„å¼‚æ„æ–¹æ¡ˆ vs ä½ çš„èšåˆæ–¹å¼

| æ–¹æ¡ˆ                  | æ˜¯å¦æ”¯æŒå¼‚æ„           | æ˜¯å¦ä¸€æ¬¡æ„å»º     | æ˜¯å¦ç»Ÿä¸€éƒ¨ç½²     | é€‚åˆåœºæ™¯                     |
| --------------------- | ---------------------- | ---------------- | ---------------- | ---------------------------- |
| **è¯¥é¡¹ç›®çš„èšåˆæ„å»º**  | âœ… æœ‰é™ï¼ˆéœ€æ ‡å‡†åŒ–è¾“å‡ºï¼‰ | âŒ å¦ï¼ˆå¤šä¸ªæ„å»ºï¼‰ | âœ… æ˜¯             | å¤šå›¢é˜Ÿç‹¬ç«‹å¼€å‘ï¼Œè¿½æ±‚ç»Ÿä¸€ä¸Šçº¿ |
| **å¾®å‰ç«¯ï¼ˆqiankunï¼‰** | âœ… æ˜¯                   | âŒ å¦             | âš ï¸ å¯ç»Ÿä¸€ä¹Ÿå¯ç‹¬ç«‹ | éœ€ç‹¬ç«‹éƒ¨ç½²ã€æŠ€æœ¯æ ˆå®Œå…¨è‡ªç”±   |
| **Module Federation** | âœ… éƒ¨åˆ†ï¼ˆWebpack ä½“ç³»ï¼‰ | âš ï¸ ä¼ªä¸€æ¬¡æ„å»º     | âœ… æ˜¯             | æŠ€æœ¯æ ˆç›¸è¿‘ï¼Œéœ€åŠ¨æ€åŠ è½½       |
| **Nginx åå‘ä»£ç†**    | âœ… æ˜¯                   | âŒ å¦             | âŒ å¦ï¼ˆå¤šæœåŠ¡ï¼‰   | ç‹¬ç«‹ç³»ç»Ÿé›†æˆï¼Œä¸è¦æ±‚ç»Ÿä¸€éƒ¨ç½² |

#### 2.8ã€âœ… æ€»ç»“å›ç­”ï¼ˆå¯ç”¨äºé¢è¯•ï¼‰

- è¯¥é¡¹ç›®ä¸º **â€˜æ„å»ºåé™æ€èšåˆâ€™æ¨¡å¼**â€”â€”å³å¤–å±‚é¡¹ç›®ä¸å‚ä¸æ„å»ºï¼Œåªè´Ÿè´£è°ƒç”¨å„å­é¡¹ç›®çš„ `npm run build` å¹¶åˆå¹¶äº§ç‰©â€”â€”é‚£ä¹ˆåœ¨**å„å­é¡¹ç›®èƒ½è¾“å‡ºæ ‡å‡†åŒ–é™æ€èµ„æºçš„å‰æä¸‹**ï¼Œå®ƒå¯ä»¥â€˜ä¼ªæ”¯æŒâ€™ä¸åŒæŠ€æœ¯æ ˆã€‚

- è¿™ç§æ–¹å¼çš„ä»£ä»·æ˜¯ï¼š
  - æ— æ³•åšè·¨é¡¹ç›®å…¬å…±åŒ…æå–
  - æ„å»ºä»æ˜¯å¤šä¸ªç‹¬ç«‹è¿‡ç¨‹
  - åŒ…ä½“ç§¯å¯èƒ½æ›´å¤§

- ä½†å®ƒæ¢æ¥äº†ï¼š
  - ç»Ÿä¸€éƒ¨ç½²æµç¨‹
  - ä¸€æ¬¡ä¸Šçº¿
  - è¿ç»´ç®€åŒ–

- æ‰€ä»¥ï¼Œå®ƒé€‚åˆé‚£äº›**æŠ€æœ¯æ ˆå¤šæ ·ä½†å‘å¸ƒèŠ‚å¥ä¸€è‡´ã€è¿½æ±‚è¿ç»´æ•ˆç‡**çš„ä¸­åå°å¹³å°ã€‚

### 3ã€å¾®å‰ç«¯ï¼ˆ`qiankun`ï¼‰

#### 3.1ã€ä¸ºä»€ä¹ˆå¾®å‰ç«¯ä¸æ”¯æŒâ€œä¸€æ¬¡æ„å»ºâ€ï¼Ÿ

- å¾®å‰ç«¯çš„æœ¬è´¨æ˜¯ **è§£è€¦** å’Œ **è‡ªæ²»**ï¼Œæ¯ä¸ªå­åº”ç”¨å°±åƒä¸€ä¸ªç‹¬ç«‹çš„â€œå‰ç«¯æœåŠ¡â€ï¼Œæ‹¥æœ‰è‡ªå·±çš„ï¼š
  - æŠ€æœ¯æ ˆ
  - æ„å»ºæµç¨‹ï¼ˆWebpack/Vite/React/Vue CLI ç­‰ï¼‰
  - ç‰ˆæœ¬å‘å¸ƒèŠ‚å¥
  - CI/CD æµæ°´çº¿

- æ‰€ä»¥ï¼š
  - âœ… æ¯ä¸ªå­åº”ç”¨éœ€è¦**å•ç‹¬æ‰§è¡Œæ„å»ºå‘½ä»¤**ï¼ˆå¦‚ `npm run build`ï¼‰
  - âœ… æ„å»ºäº§ç‰©ä¹Ÿå„è‡ªç‹¬ç«‹ï¼ˆ`dist/app-vue/`, `dist/app-react/`ï¼‰
  - âŒ æ— æ³•é€šè¿‡ä¸€ä¸ªå‘½ä»¤æˆ–ä¸€ä¸ªæµæ°´çº¿å®Œæˆæ‰€æœ‰å­åº”ç”¨çš„æ„å»ºæ‰“åŒ…ï¼ˆé™¤éå†™è„šæœ¬æ‰¹é‡è°ƒç”¨ï¼‰

- âš ï¸ å³ä½¿ä¸»åº”ç”¨å’Œæ‰€æœ‰å­åº”ç”¨éƒ½åœ¨åŒä¸€ä¸ªä»“åº“ï¼ˆmonorepoï¼‰ï¼Œä¹Ÿéœ€è¦åˆ†åˆ«æ„å»ºï¼Œåªæ˜¯å¯ä»¥åœ¨ä¸€ä¸ª CI æµæ°´çº¿ä¸­**é¡ºåºæˆ–å¹¶è¡Œæ‰§è¡Œå¤šä¸ªæ„å»ºä»»åŠ¡**ï¼Œä½†è¿™ä»ç„¶ä¸æ˜¯â€œä¸€æ¬¡æ„å»ºâ€ï¼Œè€Œæ˜¯â€œä¸€é”®è§¦å‘å¤šæ„å»ºâ€ã€‚

#### 3.2ã€å¾®å‰ç«¯å¯ä»¥å®ç°æ‰€æœ‰é¡¹ç›®éƒ½æ”¾åœ¨ä¸€ä¸ªä»“åº“å—ï¼Ÿ

- **å¾®å‰ç«¯å®Œå…¨å¯ä»¥å®ç°æ‰€æœ‰é¡¹ç›®éƒ½æ”¾åœ¨ä¸€ä¸ªä»“åº“ä¸­**ï¼Œè¿™ç§æ¶æ„è¢«ç§°ä¸º **å•ä»“åº“ï¼ˆMonorepoï¼‰** æ¨¡å¼ã€‚å®ƒåœ¨ç°ä»£å‰ç«¯å·¥ç¨‹ä¸­éå¸¸æµè¡Œï¼Œå°¤å…¶é€‚ç”¨äºå¤§å‹å›¢é˜Ÿæˆ–å¤æ‚ç³»ç»Ÿã€‚

- ### âœ… ä»€ä¹ˆæ˜¯ Monorepoï¼ˆå•ä»“åº“ï¼‰ï¼Ÿ

  - **Monorepoï¼ˆSingle Repositoryï¼‰** æ˜¯æŒ‡å°†å¤šä¸ªé¡¹ç›®ã€æ¨¡å—ã€æœåŠ¡ç­‰ä»£ç ç»Ÿä¸€å­˜æ”¾åœ¨ä¸€ä¸ª Git ä»“åº“ä¸­ï¼Œä½†é€šè¿‡ç›®å½•ç»“æ„å’Œå·¥å…·è¿›è¡Œé€»è¾‘éš”ç¦»ã€‚

  - ä¾‹å¦‚ï¼š

    ```
    my-platform/
    â”œâ”€â”€ packages/
    â”‚   â”œâ”€â”€ shell/           # ä¸»åº”ç”¨ï¼ˆå®¹å™¨ï¼‰
    â”‚   â”œâ”€â”€ model/           # å­åº”ç”¨ Aï¼ˆVueï¼‰
    â”‚   â”œâ”€â”€ rhea/            # å­åº”ç”¨ Bï¼ˆReactï¼‰
    â”‚   â”œâ”€â”€ shared/          # å…¬å…±ç»„ä»¶åº“
    â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°åº“
    â”œâ”€â”€ package.json
    â”œâ”€â”€ lerna.json           # æˆ– pnpm-workspace.yaml
    â””â”€â”€ README.md
    ```

    

#### 3.3ã€å¾®å‰ç«¯çš„æ‰€æœ‰é¡¹ç›®å¯ä»¥éƒ¨ç½²ä¸ºâ€œä¸€ä¸ªæœåŠ¡å•å…ƒâ€å—ï¼Ÿ

- **å¯ä»¥ï¼Œä½†â€œæœåŠ¡å•å…ƒâ€çš„å®šä¹‰éœ€è¦æ˜ç¡®ã€‚**

- å¾®å‰ç«¯æ¶æ„æœ¬èº«æ˜¯**è¿è¡Œæ—¶é›†æˆã€éƒ¨ç½²çµæ´»**çš„ï¼Œå®ƒå¹¶ä¸è¦æ±‚å¿…é¡»â€œå¤šä¸ªæœåŠ¡â€ï¼Œä¹Ÿå®Œå…¨æ”¯æŒå°†æ‰€æœ‰å­åº”ç”¨æ‰“åŒ…éƒ¨ç½²ä¸º**ä¸€ä¸ªæœåŠ¡å•å…ƒ**ï¼ˆå¦‚ä¸€ä¸ª Nginx å®¹å™¨ã€ä¸€ä¸ª Serverless å‡½æ•°ã€ä¸€ä¸ªé™æ€æœåŠ¡å™¨ç­‰ï¼‰ã€‚

**ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯â€œæœåŠ¡å•å…ƒâ€ï¼Ÿ**

- åœ¨ä¸åŒè¯­å¢ƒä¸‹ï¼Œâ€œæœåŠ¡å•å…ƒâ€å¯èƒ½æŒ‡ï¼š

  | å«ä¹‰            | è¯´æ˜                                |
  | --------------- | ----------------------------------- |
  | ğŸ–¥ï¸ ä¸€ä¸ªè¿›ç¨‹/å®¹å™¨ | å¦‚ä¸€ä¸ª Docker å®¹å™¨è¿è¡Œ Nginx æœåŠ¡   |
  | ğŸŒ ä¸€ä¸ªåŸŸå/ç«¯å£ | å¦‚ `https://your-platform.com`      |
  | ğŸ”§ ä¸€ä¸ªéƒ¨ç½²åŒ…    | å¦‚ä¸€ä¸ª `.tar.gz` æˆ– Docker é•œåƒ     |
  | ğŸ“¦ ä¸€ä¸ªæ„å»ºäº§ç‰©  | å¦‚ä¸€ä¸ª `dist/` ç›®å½•åŒ…å«æ‰€æœ‰é™æ€èµ„æº |

  - ğŸ‘‰ **å¾®å‰ç«¯å®Œå…¨æ”¯æŒå°†æ‰€æœ‰é¡¹ç›®æ„å»ºæˆä¸€ä¸ª `dist/`ï¼Œéƒ¨ç½²åˆ°ä¸€ä¸ªæœåŠ¡å•å…ƒä¸­ã€‚**

**ï¼ˆ2ï¼‰å¦‚ä½•å®ç°â€œä¸€ä¸ªæœåŠ¡å•å…ƒâ€éƒ¨ç½²ï¼Ÿ**

- âœ… åœºæ™¯ç¤ºä¾‹ï¼šä¸»åº”ç”¨ + å¤šä¸ªå­åº”ç”¨ â†’ æ‰“åŒ…æˆä¸€ä¸ª Nginx é•œåƒ

  ```
  dist/
  â”œâ”€â”€ index.html           # ä¸»åº”ç”¨ï¼ˆshellï¼‰
  â”œâ”€â”€ model/               # å­åº”ç”¨ A æ„å»ºäº§ç‰©
  â”œâ”€â”€ rhea/                # å­åº”ç”¨ B æ„å»ºäº§ç‰©
  â”œâ”€â”€ static/              # å…¬å…±èµ„æº
  â””â”€â”€ favicon.ico
  ```

- è¿™ä¸ª `dist/` è¢«æ‰“åŒ…è¿›ä¸€ä¸ª Docker é•œåƒï¼š

  ```
  FROM nginx:alpine
  COPY dist /usr/share/nginx/html
  EXPOSE 80
  CMD ["nginx", "-g", "daemon off;"]
  ```

- ç„¶åæ•´ä¸ªç³»ç»Ÿè¿è¡Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œå¯¹å¤–æš´éœ²ä¸€ä¸ªç«¯å£ã€‚âœ… è¿™å°±æ˜¯ä¸€ä¸ªâ€œæœåŠ¡å•å…ƒâ€

**ï¼ˆ3ï¼‰å¾®å‰ç«¯ â‰  å¿…é¡»å¤šæœåŠ¡**

- å¾ˆå¤šäººè¯¯ä»¥ä¸ºå¾®å‰ç«¯å¿…é¡»ï¼š
  - æ¯ä¸ªå­åº”ç”¨ç‹¬ç«‹éƒ¨ç½²
  - ç‹¬ç«‹åŸŸå
  - ç‹¬ç«‹ CI/CD æµæ°´çº¿

- âŒ è¿™æ˜¯è¯¯è§£ã€‚

- å¾®å‰ç«¯çš„æ ¸å¿ƒæ˜¯ **â€œæŠ€æœ¯å¼‚æ„ + ç‹¬ç«‹å¼€å‘ + è¿è¡Œæ—¶é›†æˆâ€**ï¼Œ**ä¸å¼ºåˆ¶è¦æ±‚éƒ¨ç½²æ–¹å¼**ã€‚

| éƒ¨ç½²æ¨¡å¼                   | æ˜¯å¦æ”¯æŒ         |
| -------------------------- | ---------------- |
| æ‰€æœ‰é¡¹ç›®æ‰“åŒ…æˆä¸€ä¸ªæœåŠ¡å•å…ƒ | âœ… æ”¯æŒï¼ˆå¸¸è§ï¼‰   |
| æ¯ä¸ªå­åº”ç”¨ç‹¬ç«‹éƒ¨ç½²         | âœ… æ”¯æŒï¼ˆæ›´çµæ´»ï¼‰ |
| ä¸»åº”ç”¨ç‹¬ç«‹ï¼Œå­åº”ç”¨èšåˆ     | âœ… æ”¯æŒ           |

#### 3.1ã€å¾®å‰ç«¯å…·ä½“å®ç°æ­¥éª¤

- ä»¥ **ä¸»åº”ç”¨ï¼ˆ`Main App`ï¼‰ + å­åº”ç”¨ï¼ˆ`Sub App`ï¼‰** æ¨¡å¼ä¸ºä¾‹ï¼Œå®ç°å¤šæŠ€æœ¯æ ˆå‰ç«¯é¡¹ç›®èšåˆã€‚

**ï¼ˆ1ï¼‰ä¸»åº”ç”¨ï¼ˆ`Container App`ï¼‰æ­å»º**

- ä¸»åº”ç”¨è´Ÿè´£è·¯ç”±åˆ†å‘ã€å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å…¬å…±èƒ½åŠ›æ³¨å…¥ï¼ˆå¦‚ç™»å½•æ€ã€èœå•ã€é€šçŸ¥ç­‰ï¼‰ã€‚

  ```
  # 1. å®‰è£… qiankun
  npm install qiankun -S
  ```

  ```
  // 2. åœ¨ä¸»åº”ç”¨å…¥å£æ³¨å†Œå¾®å‰ç«¯
  import { registerMicroApps, start } from 'qiankun';
  
  // æ³¨å†Œå­åº”ç”¨
  registerMicroApps([
    {
      name: 'app-vue',           // å­åº”ç”¨åç§°
      entry: '//localhost:8081', // å­åº”ç”¨å…¥å£åœ°å€ï¼ˆHTMLï¼‰
      container: '#subapp-container', // æ¸²æŸ“èŠ‚ç‚¹
      activeRule: '/app-vue',    // æ¿€æ´»è·¯å¾„
    },
    {
      name: 'app-react',
      entry: '//localhost:3000',
      container: '#subapp-container',
      activeRule: '/app-react',
    }
  ]);
  
  // å¯åŠ¨å¾®å‰ç«¯
  start({
    sandbox: true,               // å¯ç”¨æ²™ç®±ï¼ˆéš”ç¦»æ ·å¼å’Œå˜é‡ï¼‰
    singular: true,              // å•å®ä¾‹æ¨¡å¼
  });
  ```

  ```
  <!-- 3. ä¸»åº”ç”¨ HTML ä¸­é¢„ç•™å®¹å™¨ -->
  <div id="subapp-container"></div>
  ```

**ï¼ˆ2ï¼‰å­åº”ç”¨æ”¹é€ ï¼ˆä»¥ `Vue` å’Œ `React` ä¸ºä¾‹ï¼‰**

- å­åº”ç”¨éœ€è¦æ”¯æŒâ€œ**ä½œä¸ºæ¨¡å—è¢«åŠ è½½**â€ï¼Œä¸èƒ½ç›´æ¥æŒ‚è½½åˆ° `#app`ã€‚

- #####  `Vue` å­åº”ç”¨æ”¹é€ ï¼ˆ`Vue CLI`ï¼‰

  ```
  // src/main.ts æˆ– main.js
  import { createApp } from 'vue';
  import App from './App.vue';
  
  let instance: any = null;
  
  // å°è£…æ¸²æŸ“å‡½æ•°
  function render(props: any = {}) {
    const { container } = props;
    instance = createApp(App).mount(container ? container.querySelector('#app') : '#app');
  }
  
  // åˆ¤æ–­æ˜¯å¦åœ¨ qiankun ç¯å¢ƒä¸‹
  if (!(window as any).__POWERED_BY_QIANKUN__) {
    // ç‹¬ç«‹è¿è¡Œæ—¶
    render();
  } else {
    // å¾®å‰ç«¯ç¯å¢ƒä¸‹ï¼Œæš´éœ²ç”Ÿå‘½å‘¨æœŸé’©å­
    (window as any).render = render;
  }
  
  // å¿…é¡»å¯¼å‡ºç”Ÿå‘½å‘¨æœŸ
  export async function bootstrap() {
    console.log('Vue app bootstraped');
  }
  
  export async function mount(props: any) {
    console.log('Vue app mounted', props);
    render(props);
  }
  
  export async function unmount() {
    instance?.unmount();
  }
  ```

  ```
  // vue.config.jsï¼šé…ç½®æ‰“åŒ…ä¸º umd æ¨¡å—
  module.exports = {
    outputDir: 'dist',
    assetsDir: 'static',
    publicPath: process.env.NODE_ENV === 'production' ? '/app-vue/' : 'http://localhost:8081/',
    configureWebpack: {
      output: {
        library: `vue-app`,
        libraryTarget: 'umd',
        jsonpFunction: `webpackJsonp_vue_app`,
      },
    },
  };
  ```

- **`React` å­åº”ç”¨æ”¹é€ ï¼ˆ`Create React App`ï¼‰**

  ```
  // src/index.tsx
  import React from 'react';
  import ReactDOM from 'react-dom/client';
  import App from './App';
  
  let root: any = null;
  
  function render(props: any = {}) {
    const { container } = props;
    const dom = container?.querySelector('#root') || document.getElementById('root');
    root = ReactDOM.createRoot(dom);
    root.render(<App />);
  }
  
  if (!(window as any).__POWERED_BY_QIANKUN__) {
    render();
  } else {
    (window as any).render = render;
  }
  
  export async function bootstrap() {}
  export async function mount(props: any) { render(props); }
  export async function unmount() { root?.unmount(); }
  ```

  ```
  // public/index.htmlï¼šåŠ¨æ€è®¾ç½® base
  <script>
    if (window.__POWERED_BY_QIANKUN__) {
      // åŠ¨æ€è®¾ç½® publicPathï¼Œé˜²æ­¢èµ„æºåŠ è½½å¤±è´¥
      __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
    }
  </script>
  ```

  ```
  // config-overrides.jsï¼ˆéœ€ä½¿ç”¨ craco æˆ– react-app-rewiredï¼‰
  module.exports = {
    webpack: (config) => {
      config.output.library = `react-app`;
      config.output.libraryTarget = 'umd';
      config.output.jsonpFunction = `webpackJsonp_react_app`;
      return config;
    },
  };
  ```

























