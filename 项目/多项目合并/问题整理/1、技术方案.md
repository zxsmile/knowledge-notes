## ä¸€ã€å›ç­”

æˆ‘ä»¬åŸæ¥æœ‰äº”å…­ä¸ªå‰ç«¯å­é¡¹ç›®ï¼Œæ¯ä¸ªéƒ½ç‹¬ç«‹éƒ¨ç½²åœ¨å®¹å™¨å¹³å°ä¸Šï¼Œå ç”¨ç‹¬ç«‹çš„æœåŠ¡å•å…ƒå’Œèµ„æºï¼Œä¸ä»…èµ„æºæˆæœ¬é«˜ï¼Œæ¯æ¬¡ä¸Šçº¿éƒ½è¦æŒ¨ä¸ªèµ°æµç¨‹ï¼Œæ•ˆç‡å¾ˆä½ã€‚æ‰€ä»¥è¿™æ¬¡åˆå¹¶çš„ç›®æ ‡å°±æ˜¯â€”â€”**å¤šé¡¹ç›®å…±ç”¨ä¸€ä¸ªæœåŠ¡å•å…ƒï¼Œä¸€æ¬¡éƒ¨ç½²ï¼Œå…¨éƒ¨ä¸Šçº¿**ã€‚

ä½†é—®é¢˜æ¥äº†ï¼šæ€ä¹ˆè®©è¿™äº›åŸæœ¬ç‹¬ç«‹çš„é¡¹ç›®ï¼Œåœ¨åŒä¸€ä¸ªå®¹å™¨é‡Œå’Œè°å…±å­˜ï¼Œè¿˜èƒ½æ­£å¸¸è®¿é—®ï¼Ÿ

æˆ‘çš„æ€è·¯æ˜¯ï¼š**ç”¨ä¸€ä¸ª `Vue` ä½œä¸ºå£³é¡¹ç›®ï¼ŒæŠŠå„ä¸ªå­é¡¹ç›®æ‰“åŒ…åˆ°ä¸åŒçš„ç›®å½•ä¸‹ï¼Œå†é€šè¿‡ç»Ÿä¸€çš„å…¥å£è·¯ç”±å»åˆ†å‘è®¿é—®**ã€‚å¬èµ·æ¥ç®€å•ï¼Œä½†çœŸæ­£è½åœ°åˆ°å®¹å™¨å¹³å°çš„æ—¶å€™ï¼Œå°±æ¶‰åŠåˆ°ä¸€æ•´å¥— `CI/CD` å’Œå®¹å™¨åŒ–é…ç½®çš„é—®é¢˜ã€‚

## äºŒã€è¿½é—®é—®é¢˜

### 1ã€è¯¥æ–¹æ¡ˆåœ¨æœ€å¤–å±‚å¯¹æ¯ä¸ªé¡¹ç›®éƒ½æ‰§è¡Œäº†`npm run build`ï¼Œæ˜¯çœŸæ­£çš„ä¸€æ¬¡æ„å»ºå—ï¼Ÿ

- å¦‚æœæ˜¯åœ¨å¤–å±‚é¡¹ç›®ä¸­ä¾æ¬¡æ‰§è¡Œäº†å¤šä¸ªå­é¡¹ç›®çš„ `npm run build`ï¼ˆå³æ¯ä¸ªå­é¡¹ç›®ç‹¬ç«‹æ„å»ºï¼‰ï¼Œé‚£ä¹ˆè¿™ **ä¸æ˜¯çœŸæ­£çš„ä¸€æ¬¡æ„å»º**ã€‚è¿™å±äºâ€œ**èšåˆå¼æ„å»º**â€æˆ–â€œ**ä¸€é”®å¤šæ„å»º**â€ï¼Œè€Œä¸æ˜¯â€œ**ç»Ÿä¸€æ„å»ºæµç¨‹**â€æ„ä¹‰ä¸Šçš„â€œçœŸæ­£ä¸€æ¬¡æ„å»ºâ€ã€‚

#### 1.1ã€ä¸ºä»€ä¹ˆä¸æ˜¯â€œçœŸæ­£çš„ä¸€æ¬¡æ„å»ºâ€ï¼Ÿ

- æˆ‘ä»¬å…ˆæ˜ç¡®â€œçœŸæ­£ä¸€æ¬¡æ„å»ºâ€çš„æ ¸å¿ƒç‰¹å¾ï¼š

  | ç‰¹å¾           | è¯´æ˜                                                       |
  | -------------- | ---------------------------------------------------------- |
  | ğŸ”„ å•ä¸€æ„å»ºè¿›ç¨‹ | åªå¯åŠ¨ä¸€ä¸ªæ„å»ºå·¥å…·ï¼ˆå¦‚ `Webpack`ã€`Vite`ï¼‰å®ä¾‹             |
  | ğŸ§© ç»Ÿä¸€ä¾èµ–è§£æ | æ‰€æœ‰ä»£ç åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è¢«åˆ†æã€æ‰“åŒ…                       |
  | ğŸ“¦ å…±äº«ä¼˜åŒ–ç­–ç•¥ | `splitChunks`ã€`tree-shaking`ã€`scope hoisting` è·¨é¡¹ç›®ç”Ÿæ•ˆ |
  | ğŸ“ ä¸€æ¬¡è¾“å‡º     | æ‰€æœ‰äº§ç‰©ç”±åŒä¸€ä¸ªæ„å»ºæµç¨‹ç”Ÿæˆå¹¶å†™å…¥ `dist/`                 |

### 2ã€å­é¡¹ç›®çš„æŠ€æœ¯æ ˆéƒ½æ˜¯ä¸€æ ·çš„å—ï¼Ÿè‹¥æœ‰ä¸åŒæŠ€æœ¯æ ˆçš„é¡¹ç›®ï¼Œè¿™ç§æ–¹æ¡ˆè¿˜é€‚åˆå—ï¼Ÿå¦‚æœä¸é€‚åˆæœ‰ä»€ä¹ˆåˆ«çš„æ–¹æ¡ˆï¼Ÿ

#### 1.1ã€å­é¡¹ç›®çš„æŠ€æœ¯æ ˆéƒ½æ˜¯ä¸€æ ·çš„å—ï¼Ÿ

- åœ¨æœ¬æ¬¡â€œå‰ç«¯å¤šé¡¹ç›®æœåŠ¡å•å…ƒåˆå¹¶â€é¡¹ç›®ä¸­ï¼Œæ‰€æ¶‰åŠçš„å­é¡¹ç›®**æŠ€æœ¯æ ˆæ˜¯ç»Ÿä¸€çš„**ï¼Œå‡ä¸º **`Vue.js + Webpack + Vue CLI`** æ„å»ºçš„å•é¡µåº”ç”¨ï¼ˆ`SPA`ï¼‰ï¼Œå¹¶ä¸”è·¯ç”±æ¨¡å¼ã€æ‰“åŒ…ç»“æ„ã€å…¬å…±èµ„æºå¼•ç”¨æ–¹å¼ç­‰éƒ½è¾ƒä¸ºä¸€è‡´ã€‚è¿™ä¸ºé‡‡ç”¨â€œå¤–å±‚å£³å·¥ç¨‹ + å¤šå…¥å£æ„å»ºâ€çš„æ–¹æ¡ˆæä¾›äº†è‰¯å¥½çš„å‰ææ¡ä»¶ã€‚
- åœ¨æˆ‘ä»¬è¿™ä¸ªå…·ä½“çš„é¡¹ç›®ä¸­ï¼Œå‚ä¸åˆå¹¶çš„**æ‰€æœ‰å­é¡¹ç›®æŠ€æœ¯æ ˆæ˜¯ç»Ÿä¸€çš„**â€”â€”å®ƒä»¬éƒ½æ˜¯åŸºäº **`Vue 2 + Vue CLI + Webpack`** æ„å»ºçš„å•é¡µåº”ç”¨ï¼Œä¸”ç”±åŒä¸€ä¸ªå‰ç«¯å›¢é˜Ÿç»´æŠ¤ï¼Œä¾èµ–ç‰ˆæœ¬å’Œæ„å»ºæ–¹å¼é«˜åº¦ä¸€è‡´ã€‚æ­£æ˜¯åŸºäºè¿™ä¸ªå‰æï¼Œæˆ‘ä»¬æ‰èƒ½é‡‡ç”¨â€œå¤–å±‚ `Vue` é¡¹ç›®åŒ…è£¹ + å¤šå…¥å£æ„å»º + ç›®å½•éš”ç¦»â€çš„æ–¹æ¡ˆï¼Œå®ç°ä»£ç ä»“åº“åˆå¹¶ã€ç»Ÿä¸€ CI/CD æµæ°´çº¿å’Œéƒ¨ç½²åˆ°ä¸€ä¸ªæœåŠ¡å•å…ƒçš„ç›®æ ‡

#### 1.2ã€è‹¥æœ‰ä¸åŒæŠ€æœ¯æ ˆçš„é¡¹ç›®ï¼Œè¿™ç§æ–¹æ¡ˆè¿˜é€‚åˆå—ï¼Ÿ

##### 1.2.1ã€ä¸å®Œå…¨é€‚ç”¨ï¼Œå­˜åœ¨è¾ƒå¤§å±€é™æ€§

- æˆ‘ä»¬å½“å‰æ–¹æ¡ˆçš„æ ¸å¿ƒæ˜¯ï¼š
  - ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„ `Vue` é¡¹ç›®ä½œä¸ºå¤–å£³ï¼›
  - æ‰€æœ‰å­é¡¹ç›®é€šè¿‡ç›¸åŒæ„å»ºå·¥å…·ï¼ˆ`Webpack`ï¼‰æ‰“åŒ…è¾“å‡ºåˆ° `dist` ä¸åŒç›®å½•ï¼›
  - é€šè¿‡ `Nginx` è·¯ç”±æ˜ å°„å®ç°æŒ‰è·¯å¾„è®¿é—®ã€‚
- å½“å‰æ–¹æ¡ˆçš„æ ¸å¿ƒä¼˜åŠ¿ï¼ˆé€‚ç”¨äºæŠ€æœ¯æ ˆç»Ÿä¸€åœºæ™¯ï¼‰ï¼š
  - **æ„å»ºå¯ç»Ÿä¸€**ï¼šå¯ä»¥ç”¨ä¸€å¥— `Webpack` é…ç½®å¤„ç†æ‰€æœ‰å­é¡¹ç›®çš„æ‰“åŒ…é€»è¾‘ã€‚
  - **ä¾èµ–å¯å…±äº«**ï¼šé€šè¿‡ `splitChunks` æå–å…¬å…±ä¾èµ–ï¼ˆå¦‚ `Vue`ã€`Element U`Iã€å­—ä½“ã€å…¬å…±ç»„ä»¶ç­‰ï¼‰ï¼Œæ˜¾è‘—å‡å°‘æ•´ä½“åŒ…ä½“ç§¯ï¼Œå®ç°èµ„æºå¤ç”¨ã€‚
  - **éƒ¨ç½²é«˜æ•ˆ**ï¼šä¸€æ¬¡æ„å»ºã€ä¸€æ¬¡éƒ¨ç½²ï¼Œæ»¡è¶³â€œå¤šé¡¹ç›®åŒæ­¥ä¸Šçº¿â€çš„ä¸šåŠ¡éœ€æ±‚ï¼Œé™ä½è¿ç»´æˆæœ¬ã€‚
  - **ç»´æŠ¤æˆæœ¬ä½**ï¼šå·¥ç¨‹åŒ–è„šæœ¬é›†ä¸­ç®¡ç†ï¼Œé…ç½®ç»Ÿä¸€ï¼Œé€‚åˆå†…éƒ¨ç³»ç»Ÿå¿«é€Ÿè¿­ä»£ã€‚
- å› æ­¤ï¼Œå½“å‰â€œå¤šå…¥å£ `Webpack` æ„å»º + é™æ€åˆå¹¶éƒ¨ç½²â€çš„æ–¹æ¡ˆï¼Œä»…é€‚ç”¨äºæŠ€æœ¯æ ˆä¸€è‡´æˆ–é«˜åº¦ç›¸ä¼¼çš„é¡¹ç›®èšåˆåœºæ™¯ã€‚

- æ‰€ä»¥ï¼Œ**è¿™ä¸ªæ–¹æ¡ˆéå¸¸é€‚åˆæŠ€æœ¯æ ˆä¸€è‡´ã€å›¢é˜Ÿé›†ä¸­ã€è¿½æ±‚ä¸Šçº¿æ•ˆç‡çš„åœºæ™¯**ã€‚

##### 1.2.2ã€å½“å­é¡¹ç›®æŠ€æœ¯æ ˆä¸åŒæ—¶ï¼ˆå¦‚ `React`ã€`Angular`ã€`Vue2/Vue3` æ··åˆã€ç”šè‡³ `jQuery` é¡¹ç›®ï¼‰ï¼Œä¼šé¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š

| é—®é¢˜                                | è¯´æ˜                                                         |
| ----------------------------------- | :----------------------------------------------------------- |
| **æ„å»ºå·¥å…·å·®å¼‚ / æ„å»ºå·¥å…·é“¾ä¸ä¸€è‡´** | æ¯”å¦‚æœ‰çš„é¡¹ç›®æ˜¯ `React + Webpack`ï¼Œæœ‰çš„æ˜¯ `Vue 3 + Vite`ï¼Œç”šè‡³è¿˜æœ‰ `Angular` æˆ–åŸç”Ÿ `JS` é¡¹ç›®ï¼Œå®ƒä»¬çš„æ„å»ºè¾“å‡ºç»“æ„ã€èµ„æºå¼•ç”¨æ–¹å¼ã€ç¯å¢ƒå˜é‡å¤„ç†éƒ½ä¸åŒï¼Œæ— æ³•ç”¨åŒä¸€å¥— `Webpack` é…ç½®ç»Ÿä¸€æ„å»ºã€‚ |
| **ä¾èµ–å†²çª**                        | ä¸åŒæ¡†æ¶å¯¹ `node_modules`ã€`polyfill`ã€å…¨å±€å˜é‡å¤„ç†ä¸åŒï¼Œä¸åŒæ¡†æ¶çš„è¿è¡Œæ—¶ï¼ˆå¦‚ `React 17 vs React 18`ï¼‰æˆ–å…¬å…±åº“ç‰ˆæœ¬å·®å¼‚å¯èƒ½å¯¼è‡´å…¨å±€ä¾èµ–å®‰è£…å¤±è´¥æˆ–è¿è¡Œå¼‚å¸¸ã€‚ |
| **è¿è¡Œæ—¶å†²çªé£é™©é«˜**                | å¤šä¸ª `Vue` å®ä¾‹æˆ– `React` ç‰ˆæœ¬å…±å­˜ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€äº‹ä»¶ç»‘å®šé”™ä¹±ã€æ ·å¼æ±¡æŸ“ç­‰é—®é¢˜ã€‚ |
| **æ›´æ–°è€¦åˆä¸¥é‡**                    | å³ä½¿åªä¿®æ”¹äº†ä¸€ä¸ª `React` å­é¡¹ç›®ï¼Œä¹Ÿéœ€è¦é‡æ–°æ„å»ºæ•´ä¸ªåˆå¹¶åŒ…ï¼Œè¿èƒŒäº†â€œç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²â€çš„å¾®æœåŠ¡ç†å¿µã€‚ |
| **å…¬å…±èµ„æºå…±äº«å›°éš¾**                | ä¸åŒæ¡†æ¶å¯¹ vendor chunk çš„ç”Ÿæˆè§„åˆ™ä¸åŒï¼Œ`splitChunks` æ— æ³•è·¨å·¥å…·ç”Ÿæ•ˆ |
| **å·¥ç¨‹å¤æ‚åº¦å‰§å¢**                  | å¤–å±‚é¡¹ç›®éœ€è¦ä¸ºæ¯ç§æŠ€æœ¯æ ˆå†™é€‚é…é€»è¾‘ï¼Œæ„å»ºè„šæœ¬å˜å¾—éš¾ä»¥ç»´æŠ¤ï¼Œ`CI/CD` æµæ°´çº¿ä¹Ÿä¼šå¼‚å¸¸è‡ƒè‚¿ã€‚ |

#### 1.3ã€å¦‚æœä¸é€‚åˆæœ‰ä»€ä¹ˆåˆ«çš„æ–¹æ¡ˆï¼Ÿ

##### 3.1ã€æ›´åˆé€‚çš„æ›¿ä»£æ–¹æ¡ˆï¼šå¾®å‰ç«¯æ¶æ„ï¼ˆ`Micro Frontends`ï¼‰

- è¿™æ˜¯è§£å†³å¤šæŠ€æœ¯æ ˆå‰ç«¯èšåˆçš„æœ€ä½³å®è·µï¼Œå½“é¢ä¸´å¤šæŠ€æœ¯æ ˆã€å¤šå›¢é˜Ÿåä½œã€ç‹¬ç«‹éƒ¨ç½²ç­‰å¤æ‚åœºæ™¯æ—¶ï¼Œæˆ‘ä¼šæ¨èé‡‡ç”¨ **å¾®å‰ç«¯æ¶æ„**ï¼Œæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ä»¥ä¸‹å‡ ç§ä¸»æµæ–¹æ¡ˆï¼š

  ï¼ˆ1ï¼‰

  

  

  

  (1)1. **Module Federationï¼ˆWebpack 5ï¼‰** âœ… æ¨è

  - **é€‚ç”¨åœºæ™¯**ï¼šVue/React/Angular æ··åˆé¡¹ç›®ï¼Œæ„å»ºæ—¶åŠ¨æ€åŠ è½½è¿œç¨‹æ¨¡å—ã€‚

  - ä¼˜ç‚¹

    ï¼š

    - åŸç”Ÿæ”¯æŒï¼Œæ€§èƒ½å¥½ã€‚
    - å¯å…±äº«ä¾èµ–ï¼ˆå¦‚å…±åŒä½¿ç”¨ä¸€ä¸ªç‰ˆæœ¬çš„ Vue æˆ– Lodashï¼‰ã€‚
    - æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åŠ è½½å­åº”ç”¨ã€‚

  - **å®ç°æ–¹å¼**ï¼šä¸»åº”ç”¨ä½œä¸ºå®¹å™¨ï¼Œä»è¿œç¨‹åœ°å€åŠ è½½å­åº”ç”¨çš„ `remoteEntry.js`ã€‚

  - ç¤ºä¾‹

    ï¼š

    jsæ·±è‰²ç‰ˆæœ¬

    ```
    // ä¸»åº”ç”¨ webpack.config.js
    new ModuleFederationPlugin({
      name: 'shell_app',
      remotes: {
        risk: 'riskApp@https://risk.example.com/remoteEntry.js',
        audit: 'auditApp@https://audit.example.com/remoteEntry.js'
      },
      shared: ['vue', 'react', 'lodash']
    });
    ```

  ##### 2. **qiankun / single-spa**

  - **é€‚ç”¨åœºæ™¯**ï¼šå®Œå…¨å¼‚æ„çš„æŠ€æœ¯æ ˆï¼Œæ”¯æŒä»»æ„æ¡†æ¶ã€‚

  - ä¼˜ç‚¹

    ï¼š

    - çµæ´»æ€§æé«˜ï¼Œæ”¯æŒ Vueã€Reactã€Angularã€jQuery é¡¹ç›®å…±å­˜ã€‚
    - æä¾› JS æ²™ç®±ã€æ ·å¼éš”ç¦»ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

  - **ç¼ºç‚¹**ï¼šå¼•å…¥é¢å¤–è¿è¡Œæ—¶å¼€é”€ï¼Œéœ€å¤„ç†é€šä¿¡ã€çŠ¶æ€å…±äº«ç­‰é—®é¢˜ã€‚

  - **é€‚åˆå¤§å‹å¹³å°å‹äº§å“**ï¼Œå¦‚ä¸­å°ç³»ç»Ÿã€ä¼ä¸šçº§é—¨æˆ·ã€‚

  ##### 3. **iframe æ–¹æ¡ˆ**

  - **é€‚ç”¨åœºæ™¯**ï¼šç³»ç»Ÿå®Œå…¨ç‹¬ç«‹ã€å®‰å…¨æ€§è¦æ±‚é«˜ã€æ¥å—ä¸€å®šæ€§èƒ½æŸè€—ã€‚
  - **ä¼˜ç‚¹**ï¼šå¤©ç„¶éš”ç¦»ï¼ŒæŠ€æœ¯æ ˆè‡ªç”±ï¼Œéƒ¨ç½²ç‹¬ç«‹ã€‚
  - **ç¼ºç‚¹**ï¼šé€šä¿¡å¤æ‚ã€SEO å·®ã€ç§»åŠ¨ç«¯ä½“éªŒä¸ä½³ã€æ— æ³•å…±äº«ç™»å½•æ€ç­‰ã€‚

  ##### 4. **åå‘ä»£ç† + ç»Ÿä¸€å…¥å£é¡µï¼ˆNginx Gatewayï¼‰**

  - æ‰€æœ‰å­é¡¹ç›®ç‹¬ç«‹éƒ¨ç½²ï¼Œé€šè¿‡ Nginx æŒ‰è·¯å¾„è½¬å‘è¯·æ±‚ã€‚
  - ä½¿ç”¨ä¸€ä¸ª Portal é¡µé¢åšèœå•å¯¼èˆªæˆ–åµŒå…¥å¼è·³è½¬ã€‚
  - **é€‚åˆè½»é‡çº§æ•´åˆ**ï¼Œæ— éœ€æ·±åº¦é›†æˆã€‚

  ------

  ### **æˆ‘çš„æŠ€æœ¯é€‰å‹æ€è·¯æ€»ç»“ï¼š**

  | åœºæ™¯ç‰¹å¾                           | æ¨èæ–¹æ¡ˆ                       |
  | ---------------------------------- | ------------------------------ |
  | æŠ€æœ¯æ ˆç»Ÿä¸€ã€å›¢é˜Ÿé›†ä¸­ã€è¿½æ±‚éƒ¨ç½²æ•ˆç‡ | âœ… å½“å‰çš„å¤šå…¥å£åˆå¹¶æ„å»º         |
  | æŠ€æœ¯æ ˆå¤šæ ·ã€å¤šå›¢é˜Ÿåä½œã€éœ€ç‹¬ç«‹éƒ¨ç½² | âœ… Module Federation æˆ– qiankun |
  | å®‰å…¨éš”ç¦»è¦æ±‚é«˜ã€ç³»ç»Ÿå®Œå…¨ç‹¬ç«‹       | âœ… iframe + ç‹¬ç«‹éƒ¨ç½²            |
  | å¿«é€Ÿæ•´åˆã€æ— éœ€æ·±åº¦äº¤äº’             | âœ… Nginx åå‘ä»£ç† + Portal      |

  > åœ¨æˆ‘ä»¬åæ´—é’±å¹³å°é¡¹ç›®ä¸­ï¼Œç”±äºæ‰€æœ‰å­ç³»ç»Ÿå‡ä¸º Vue æŠ€æœ¯æ ˆä¸”ç”±åŒä¸€å›¢é˜Ÿå¼€å‘ï¼Œå› æ­¤é€‰æ‹©â€œåˆå¹¶æ„å»º + ç»Ÿä¸€éƒ¨ç½²â€æ˜¯æœ€ä¼˜è§£ã€‚ä½†å¦‚æœæœªæ¥éœ€è¦æ¥å…¥ç¬¬ä¸‰æ–¹ç³»ç»Ÿæˆ–æŠ€æœ¯æ ˆå·®å¼‚å˜å¤§ï¼Œæˆ‘ä¼šä¼˜å…ˆæ¨åŠ¨å‘ **Module Federation** è¿ç§»ï¼Œå› ä¸ºå®ƒæ—¢èƒ½ä¿æŒæŠ€æœ¯è‡ªç”±åº¦ï¼Œåˆèƒ½å®ç°ä¾èµ–å…±äº«å’Œé«˜æ•ˆåŠ è½½ï¼Œæ˜¯ç›®å‰æœ€å¹³è¡¡çš„å¾®å‰ç«¯æ–¹æ¡ˆã€‚

#### 1.4ã€å¾®å‰ç«¯ï¼ˆ`qiankun`ï¼‰å…·ä½“å®ç°æ­¥éª¤

- ä»¥ **ä¸»åº”ç”¨ï¼ˆ`Main App`ï¼‰ + å­åº”ç”¨ï¼ˆ`Sub App`ï¼‰** æ¨¡å¼ä¸ºä¾‹ï¼Œå®ç°å¤šæŠ€æœ¯æ ˆå‰ç«¯é¡¹ç›®èšåˆã€‚

**ï¼ˆ1ï¼‰ä¸»åº”ç”¨ï¼ˆ`Container App`ï¼‰æ­å»º**

- ä¸»åº”ç”¨è´Ÿè´£è·¯ç”±åˆ†å‘ã€å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å…¬å…±èƒ½åŠ›æ³¨å…¥ï¼ˆå¦‚ç™»å½•æ€ã€èœå•ã€é€šçŸ¥ç­‰ï¼‰ã€‚

  ```
  # 1. å®‰è£… qiankun
  npm install qiankun -S
  ```

  ```
  // 2. åœ¨ä¸»åº”ç”¨å…¥å£æ³¨å†Œå¾®å‰ç«¯
  import { registerMicroApps, start } from 'qiankun';
  
  // æ³¨å†Œå­åº”ç”¨
  registerMicroApps([
    {
      name: 'app-vue',           // å­åº”ç”¨åç§°
      entry: '//localhost:8081', // å­åº”ç”¨å…¥å£åœ°å€ï¼ˆHTMLï¼‰
      container: '#subapp-container', // æ¸²æŸ“èŠ‚ç‚¹
      activeRule: '/app-vue',    // æ¿€æ´»è·¯å¾„
    },
    {
      name: 'app-react',
      entry: '//localhost:3000',
      container: '#subapp-container',
      activeRule: '/app-react',
    }
  ]);
  
  // å¯åŠ¨å¾®å‰ç«¯
  start({
    sandbox: true,               // å¯ç”¨æ²™ç®±ï¼ˆéš”ç¦»æ ·å¼å’Œå˜é‡ï¼‰
    singular: true,              // å•å®ä¾‹æ¨¡å¼
  });
  ```

  ```
  <!-- 3. ä¸»åº”ç”¨ HTML ä¸­é¢„ç•™å®¹å™¨ -->
  <div id="subapp-container"></div>
  ```

**ï¼ˆ2ï¼‰å­åº”ç”¨æ”¹é€ ï¼ˆä»¥ `Vue` å’Œ `React` ä¸ºä¾‹ï¼‰**

- å­åº”ç”¨éœ€è¦æ”¯æŒâ€œ**ä½œä¸ºæ¨¡å—è¢«åŠ è½½**â€ï¼Œä¸èƒ½ç›´æ¥æŒ‚è½½åˆ° `#app`ã€‚

- #####  `Vue` å­åº”ç”¨æ”¹é€ ï¼ˆ`Vue CLI`ï¼‰

  ```
  // src/main.ts æˆ– main.js
  import { createApp } from 'vue';
  import App from './App.vue';
  
  let instance: any = null;
  
  // å°è£…æ¸²æŸ“å‡½æ•°
  function render(props: any = {}) {
    const { container } = props;
    instance = createApp(App).mount(container ? container.querySelector('#app') : '#app');
  }
  
  // åˆ¤æ–­æ˜¯å¦åœ¨ qiankun ç¯å¢ƒä¸‹
  if (!(window as any).__POWERED_BY_QIANKUN__) {
    // ç‹¬ç«‹è¿è¡Œæ—¶
    render();
  } else {
    // å¾®å‰ç«¯ç¯å¢ƒä¸‹ï¼Œæš´éœ²ç”Ÿå‘½å‘¨æœŸé’©å­
    (window as any).render = render;
  }
  
  // å¿…é¡»å¯¼å‡ºç”Ÿå‘½å‘¨æœŸ
  export async function bootstrap() {
    console.log('Vue app bootstraped');
  }
  
  export async function mount(props: any) {
    console.log('Vue app mounted', props);
    render(props);
  }
  
  export async function unmount() {
    instance?.unmount();
  }
  ```

  ```
  // vue.config.jsï¼šé…ç½®æ‰“åŒ…ä¸º umd æ¨¡å—
  module.exports = {
    outputDir: 'dist',
    assetsDir: 'static',
    publicPath: process.env.NODE_ENV === 'production' ? '/app-vue/' : 'http://localhost:8081/',
    configureWebpack: {
      output: {
        library: `vue-app`,
        libraryTarget: 'umd',
        jsonpFunction: `webpackJsonp_vue_app`,
      },
    },
  };
  ```

- **`React` å­åº”ç”¨æ”¹é€ ï¼ˆ`Create React App`ï¼‰**

  ```
  // src/index.tsx
  import React from 'react';
  import ReactDOM from 'react-dom/client';
  import App from './App';
  
  let root: any = null;
  
  function render(props: any = {}) {
    const { container } = props;
    const dom = container?.querySelector('#root') || document.getElementById('root');
    root = ReactDOM.createRoot(dom);
    root.render(<App />);
  }
  
  if (!(window as any).__POWERED_BY_QIANKUN__) {
    render();
  } else {
    (window as any).render = render;
  }
  
  export async function bootstrap() {}
  export async function mount(props: any) { render(props); }
  export async function unmount() { root?.unmount(); }
  ```

  ```
  // public/index.htmlï¼šåŠ¨æ€è®¾ç½® base
  <script>
    if (window.__POWERED_BY_QIANKUN__) {
      // åŠ¨æ€è®¾ç½® publicPathï¼Œé˜²æ­¢èµ„æºåŠ è½½å¤±è´¥
      __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
    }
  </script>
  ```

  ```
  // config-overrides.jsï¼ˆéœ€ä½¿ç”¨ craco æˆ– react-app-rewiredï¼‰
  module.exports = {
    webpack: (config) => {
      config.output.library = `react-app`;
      config.output.libraryTarget = 'umd';
      config.output.jsonpFunction = `webpackJsonp_react_app`;
      return config;
    },
  };
  ```

**ï¼ˆ3ï¼‰æ„å»ºä¸éƒ¨ç½²**























