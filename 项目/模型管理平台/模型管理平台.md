é¦–æ¬¡å¼€å‘ï¼Œè´Ÿè´£æœ‰å…³ç®¡ç†é¡µé¢ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œæ‹–æ‹½

äºŒæ¬¡é‡æ„ï¼Œé¡¹ç›®ä¸»è¦è´Ÿè´£äººï¼Œè´Ÿè´£è¡¨è§†å›¾å¼€å‘ï¼Œä»¥åŠæ‰€æœ‰å·¥å…·ç®±å¼€å‘ã€

 è´Ÿè´£æ•´ä¸ªç³»ç»Ÿå‰ç«¯æ¶æ„çš„æ­å»ºï¼Œè®¾è®¡äº†é«˜æ•ˆçš„ä»£ç ç»“æ„å’Œæ¨¡å—åˆ’åˆ†ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§ã€‚ 



#### åœ¨ `Driver.js` æ–°æ‰‹å¼•å¯¼æµç¨‹ä¸­ï¼ŒæŸä¸€æ­¥è¦æ±‚ç”¨æˆ·æ‹–åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆä¾‹å¦‚ä»å·¥å…·æ æ‹–åˆ°ç”»å¸ƒï¼‰ï¼Œä¹‹åä¸‹ä¸€æ­¥è¦é«˜äº®è¿™ä¸ªâ€œå·²è¢«æ‹–åŠ¨çš„æ–°ä½ç½®â€çš„èŠ‚ç‚¹ï¼Œ`Driver.js`  å®šä½ä¼šå‡ºç°é—®é¢˜æˆ–è€…ç›´æ¥è·³è¿‡è¿™ä¸€æ­¥ã€‚

è¿™æ˜¯å› ä¸º`Driver.js` åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šç¡®å®šæ¯ä¸ªæ­¥éª¤å…ƒç´ çš„ä½ç½®å’Œå°ºå¯¸ä¿¡æ¯ï¼Œå¦‚æœè¿™äº›ä¿¡æ¯åœ¨å¼•å¯¼æµç¨‹ä¸­å‘ç”Ÿäº†å˜åŒ–ï¼ˆå¦‚é€šè¿‡æ‹–æ‹½æ”¹å˜äº†æŸä¸ªå…ƒç´ çš„ä½ç½®ï¼‰ï¼Œé‚£ä¹ˆ`Driver.js` å¯èƒ½æ— æ³•æ­£ç¡®è¯†åˆ«æ–°çš„ä½ç½®ã€‚

## è§£å†³æ–¹æ¡ˆ

1. **é‡æ–°è®¡ç®—ä½ç½®**ï¼šåœ¨ç”¨æˆ·å®Œæˆæ‹–æ‹½æ“ä½œåï¼Œå¯ä»¥é€šè¿‡è§¦å‘`Driver.js`çš„`next()`æ–¹æ³•ä¹‹å‰ï¼Œæ‰‹åŠ¨æ›´æ–°å¯¹åº”æ­¥éª¤çš„`element`å±æ€§ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°è·å–æ‹–æ‹½ç»“æŸåå…ƒç´ çš„æ–°ä½ç½®ï¼Œå¹¶æ®æ­¤è°ƒæ•´`Driver.js`ä¸­çš„é…ç½®ã€‚ä½ å¯ä»¥åœ¨æ‹–æ‹½ç»“æŸåçš„å›è°ƒå‡½æ•°ä¸­å®ç°è¿™ä¸€ç‚¹ã€‚
2. **åŠ¨æ€æ›´æ–°`Driver.js`æ­¥éª¤**ï¼šå¦‚æœä½ çŸ¥é“æŸäº›æ­¥éª¤æ˜¯åŸºäºåŠ¨æ€å†…å®¹çš„ï¼Œå¯ä»¥è€ƒè™‘åœ¨è¿›å…¥è¿™äº›æ­¥éª¤ä¹‹å‰ï¼ŒåŠ¨æ€æ›´æ–°`Driver.js`çš„æ­¥éª¤é…ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨è°ƒç”¨`driver.defineSteps()`æ–¹æ³•å®šä¹‰æ­¥éª¤æ—¶ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å®šä¹‰æ‰€æœ‰æ­¥éª¤ï¼Œè€Œæ˜¯æ ¹æ®ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºé€æ­¥å®šä¹‰æˆ–ä¿®æ”¹åç»­æ­¥éª¤ã€‚
3. **ç›‘å¬æ‹–æ‹½äº‹ä»¶å¹¶åŒæ­¥æ›´æ–°**ï¼šå¯¹äºæ”¯æŒæ‹–æ‹½åŠŸèƒ½çš„ç»„ä»¶ï¼Œå°è¯•åˆ©ç”¨å…¶æä¾›çš„æ‹–æ‹½ç»“æŸäº‹ä»¶ï¼ˆå¦‚`dragend`ã€`drop`ç­‰ï¼‰ï¼Œåœ¨è¿™äº›äº‹ä»¶è§¦å‘æ—¶æ›´æ–°`Driver.js`å¯¹ç›¸åº”æ­¥éª¤å…ƒç´ çš„å¼•ç”¨ï¼Œç¡®ä¿å®ƒæŒ‡å‘çš„æ˜¯æœ€æ–°çš„å…ƒç´ ä½ç½®ã€‚
4. **åˆ·æ–°å½“å‰æ­¥éª¤**ï¼šæœ‰äº›æƒ…å†µä¸‹ï¼Œç®€å•åœ°åˆ·æ–°å½“å‰æ­¥éª¤ä¹Ÿèƒ½è§£å†³é—®é¢˜ã€‚åœ¨æ‰§è¡Œäº†ä»»ä½•å¯èƒ½å¯¼è‡´å…ƒç´ ä½ç½®æ”¹å˜çš„æ“ä½œä¹‹åï¼Œå¯ä»¥å°è¯•è°ƒç”¨`driver.refresh()`æ¥å¼ºåˆ¶`Driver.js`é‡æ–°è¯„ä¼°å½“å‰æ­¥éª¤çš„æ‰€æœ‰å‚æ•°ï¼ŒåŒ…æ‹¬å…ƒç´ çš„ä½ç½®å’Œå¤§å°ã€‚
5. **ä½¿ç”¨`MutationObserver`**ï¼šä¸ºäº†æ›´åŠ è‡ªåŠ¨åŒ–åœ°å¤„ç†è¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥ä½¿ç”¨`MutationObserver`ç›‘æ§`DOM`çš„å˜åŒ–ï¼Œä¸€æ—¦å‘ç°ç›®æ ‡å…ƒç´ çš„ä½ç½®æˆ–å°ºå¯¸å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨é€šçŸ¥`Driver.js`è¿›è¡Œç›¸åº”çš„æ›´æ–°ã€‚

## è§£å†³æ–¹æ¡ˆä»£ç ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å¼•å¯¼æ­¥éª¤ï¼ˆè·³è¿‡é—®é¢˜æ­¥éª¤ï¼‰

```
const driver = new Driver({
  showButtons: ['next', 'previous'],
  nextBtnText: 'ä¸‹ä¸€æ­¥',
  prevBtnText: 'ä¸Šä¸€æ­¥',
});

// æ­¥éª¤1ï¼šä»‹ç»å·¥å…·æ 
const step1 = {
  element: '#toolbar',
  popover: {
    title: 'å·¥å…·æ ',
    description: 'ä»è¿™é‡Œæ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒ',
    onNext: () => {
      // ç”¨æˆ·ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€åï¼Œè¿›å…¥æ‹–æ‹½ç­‰å¾…çŠ¶æ€
      waitForDragAndContinue();
      return false; // é˜»æ­¢è‡ªåŠ¨å‰è¿›
    }
  }
};

// æ­¥éª¤3ï¼šé«˜äº®ç”»å¸ƒä¸­çš„èŠ‚ç‚¹ï¼ˆæ³¨æ„ï¼šelement ç•™ç©ºï¼Œç¨ååŠ¨æ€è®¾ç½®ï¼‰
let step3 = {
  element: null, // åŠ¨æ€èµ‹å€¼
  popover: {
    title: 'èŠ‚ç‚¹å·²æ”¾ç½®',
    description: 'ç°åœ¨ä½ å¯ä»¥é…ç½®å®ƒäº†ï¼'
  }
};
```

### ç¬¬äºŒæ­¥ï¼šç›‘å¬æ‹–æ‹½å®Œæˆäº‹ä»¶

ä½ éœ€è¦åœ¨ä½ çš„æ‹–æ‹½é€»è¾‘ä¸­ **è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶æˆ–å›è°ƒ**ï¼Œé€šçŸ¥å¼•å¯¼ç³»ç»Ÿâ€œæ‹–æ‹½å·²å®Œæˆâ€ã€‚

#### ç¤ºä¾‹ï¼ˆåŸç”Ÿ `JS` æ‹–æ‹½ï¼‰ï¼š

```
// å‡è®¾ä½ ä½¿ç”¨ HTML5 Drag & Drop
document.addEventListener('drop', function(e) {
  e.preventDefault();
  
  // å‡è®¾æ‹–æ‹½çš„æ˜¯ .draggable-nodeï¼Œæ”¾å…¥ #canvas
  if (e.target.closest('#canvas')) {
    const newNode = document.querySelector('#canvas .node:last-child'); // è·å–åˆšæ”¾å…¥çš„èŠ‚ç‚¹
    
    // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
    window.dispatchEvent(new CustomEvent('nodeDropped', { detail: { element: newNode } }));
  }
});
```

> ğŸ’¡ å¦‚æœä½ ç”¨çš„æ˜¯ **`interact.js / SortableJS / React DnD`**ï¼Œè¯·åœ¨å…¶ `onEnd` / `onDrop` å›è°ƒä¸­ `dispatch` ç±»ä¼¼äº‹ä»¶ã€‚

### ç¬¬ä¸‰æ­¥ï¼šç­‰å¾…æ‹–æ‹½å®Œæˆï¼Œå¹¶ç»§ç»­å¼•å¯¼

```
function waitForDragAndContinue() {
  // æ˜¾ç¤ºæç¤ºï¼šè¯·æ‹–æ‹½èŠ‚ç‚¹
  alert('è¯·å°†èŠ‚ç‚¹æ‹–åˆ°ç”»å¸ƒåŒºåŸŸ'); // æˆ–æ›´å‹å¥½çš„ UI æç¤º

  // ç›‘å¬æ‹–æ‹½å®Œæˆäº‹ä»¶
  const onNodeDropped = (event) => {
    const droppedElement = event.detail.element;

    // åŠ¨æ€è®¾ç½® step3 çš„ element
    step3.element = droppedElement;

    // ç§»é™¤ç›‘å¬å™¨
    window.removeEventListener('nodeDropped', onNodeDropped);

    // æ‰‹åŠ¨è·³è½¬åˆ°ä¸‹ä¸€æ­¥ï¼ˆå³ step3ï¼‰
    setTimeout(() => {
      driver.moveNext(); // æ³¨æ„ï¼šæ­¤æ—¶ step2 å·²è·³è¿‡ï¼Œdriver å†…éƒ¨éœ€å¤„ç†æ­¥éª¤ç´¢å¼•
    }, 100);
  };

  window.addEventListener('nodeDropped', onNodeDropped);
}
```

### ç¬¬å››æ­¥ï¼šè°ƒæ•´ `Driver.js` æ­¥éª¤æµç¨‹ï¼ˆå…³é”®ï¼ï¼‰

ç”±äºæˆ‘ä»¬è·³è¿‡äº†â€œæ­¥éª¤2â€ï¼Œéœ€è¦è®© `Driver.js` çŸ¥é“æ­¥éª¤é¡ºåºï¼š

```
// å¯åŠ¨å¼•å¯¼
driver.defineSteps([step1, step3]); // åªå®šä¹‰ä¸¤ä¸ªæ­¥éª¤
driver.start();
```

> âœ… è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨ `step1` ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€ï¼Œä¼šè§¦å‘ `onNext` â†’ è¿›å…¥æ‹–æ‹½ç­‰å¾… â†’ æ‹–æ‹½å®Œæˆåæ‰‹åŠ¨ `moveNext()` â†’ ç›´æ¥è¿›å…¥ `step3`ï¼ˆé«˜äº®æ–°ä½ç½®çš„èŠ‚ç‚¹ï¼‰ã€‚

**åœ¨æ‹–å…¥ç”»å¸ƒä¹‹å‰æ—¶ï¼Œå…ˆé˜»æ­¢åœ¨è¯¥æ­¥éª¤çš„`onNext`å›è°ƒå‡½æ•°ä¸­`return false`, é˜»æ­¢è‡ªåŠ¨å‰è¿›ï¼Œç„¶ååœ¨æ‹–æ‹½ç»“æŸå›è°ƒå‡½æ•°é‡Œè¾¹ï¼Œä½¿ç”¨`driver.defineSteps()`é‡æ–°å®šä¹‰åç»­çš„æ­¥éª¤ï¼Œå†ä½¿ç”¨` driver.moveNext()` ç»§ç»­åç»­æ­¥éª¤**
    

# `Driver.js`

`Driver.js` æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å‰ç«¯ `JavaScript` åº“ï¼Œç”¨äºåœ¨ç½‘é¡µä¸­åˆ›å»º**èšç„¦å¼çš„æ–°æ‰‹å¼•å¯¼ï¼ˆ`onboarding tour`ï¼‰æˆ–åŠŸèƒ½æç¤º**ã€‚å®ƒçš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ **åˆ›å»ºä¸€ä¸ªå…¨å±é®ç½©å±‚ï¼ˆ`overlay`ï¼‰**ï¼Œå¹¶åœ¨ç›®æ ‡å…ƒç´ ä½ç½®â€œæŒ–å‡ºâ€ä¸€ä¸ªé€æ˜é«˜äº®åŒºåŸŸï¼ŒåŒæ—¶æ˜¾ç¤ºè¯´æ˜å¼¹çª—ï¼ˆ`popover`ï¼‰ï¼Œä»è€Œå°†ç”¨æˆ·æ³¨æ„åŠ›å¼•å¯¼åˆ°ç‰¹å®š `UI` å…ƒç´ ä¸Šã€‚

ä¸‹é¢ä» **æ¶æ„ã€å…³é”®æœºåˆ¶ã€æ¸²æŸ“æµç¨‹** ä¸‰ä¸ªå±‚é¢æ·±å…¥è§£æå…¶å·¥ä½œåŸç†ï¼š

## ä¸€ã€æ•´ä½“æ¶æ„

`Driver.js` çš„æ ¸å¿ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

| æ¨¡å—                      | ä½œç”¨                                         |
| ------------------------- | -------------------------------------------- |
| **`Overlay`ï¼ˆé®ç½©å±‚ï¼‰**   | è¦†ç›–æ•´ä¸ªé¡µé¢çš„åŠé€æ˜è’™å±‚ï¼Œç”¨äºæ¨¡ç³Šéé‡ç‚¹åŒºåŸŸ |
| **`Highlight`ï¼ˆé«˜äº®åŒºï¼‰** | åœ¨é®ç½©ä¸Šâ€œæŒ–å­”â€ï¼Œéœ²å‡ºç›®æ ‡å…ƒç´ ï¼Œå½¢æˆè§†è§‰ç„¦ç‚¹   |
| **`Popover`ï¼ˆæç¤ºæ¡†ï¼‰**   | æ˜¾ç¤ºæ ‡é¢˜ã€æè¿°ã€æ“ä½œæŒ‰é’®çš„æµ®åŠ¨é¢æ¿           |

> ğŸ’¡ æ‰€æœ‰è¿™äº›å…ƒç´ éƒ½æ˜¯ **åŠ¨æ€åˆ›å»ºçš„ `DOM` èŠ‚ç‚¹**ï¼Œæ’å…¥åˆ° `` æœ«å°¾ï¼Œä¸æ±¡æŸ“åŸæœ‰ç»“æ„ã€‚

## äºŒã€æ ¸å¿ƒå®ç°åŸç†è¯¦è§£

### 1ã€ **å®šä½ç›®æ ‡å…ƒç´ **

`Driver.js` é€šè¿‡ `document.querySelector(selector)` è·å–ç›®æ ‡ `DOM` å…ƒç´ ï¼Œç„¶åè°ƒç”¨ï¼š

```
const rect = element.getBoundingClientRect();
```

å¾—åˆ°å…ƒç´ åœ¨**è§†å£ä¸­çš„ç»å¯¹ä½ç½®**ï¼ˆ`top, left, width, height`ï¼‰ã€‚

> âš ï¸ æ³¨æ„ï¼šè¿™ä¸ªä½ç½®åªåœ¨**æ­¥éª¤åˆå§‹åŒ–æ—¶è®¡ç®—ä¸€æ¬¡**ï¼Œåç»­ä¸ä¼šæ›´æ–° â†’ è¿™å°±æ˜¯å®ƒæ— æ³•è·Ÿè¸ªåŠ¨æ€å…ƒç´ çš„æ ¹æœ¬åŸå› ã€‚

### 2. **åˆ›å»ºé®ç½©å±‚ï¼ˆ`Overlay`ï¼‰**

- åˆ›å»ºä¸€ä¸ª

  ```
  <div class="driver-overlay">
  ```

  ï¼Œæ ·å¼å¦‚ä¸‹ï¼š

  ```
  .driver-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.6); /* åŠé€æ˜é»‘ */
    z-index: 999999;
    pointer-events: none; /* ä¸æ‹¦æˆªç‚¹å‡» */
  }
  ```

- æ’å…¥åˆ° `document.body`ã€‚

### 3. **å®ç°â€œé«˜äº®æŒ–å­”â€æ•ˆæœï¼ˆå…³é”®ï¼ï¼‰**

`Driver.js` ä½¿ç”¨ **`CSS` `clip-path`** å®ç°é«˜äº®åŒºåŸŸï¼ˆç°ä»£æµè§ˆå™¨ï¼‰ï¼Œå¹¶ä¸ºæ—§æµè§ˆå™¨æä¾› `box-shadow` å›é€€æ–¹æ¡ˆã€‚

#### âœ… æ–¹æ¡ˆ Aï¼š`clip-path`ï¼ˆæ¨èï¼‰

```
.driver-overlay {
  clip-path: polygon(
    /* å¤–å›´å››è¾¹å½¢ */
    0 0, 100% 0, 100% 100%, 0 100%,
    /* å†…éƒ¨æŒ–ç©ºåŒºåŸŸï¼ˆé€†æ—¶é’ˆï¼‰*/
    0 100%, left top, 
    left+width top, 
    left+width top+height, 
    left top+height, 
    left top,
    0 100%
  );
}
```

ä½†å®é™…ä¸Šï¼Œ`Driver.js` åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ›´ç®€æ´çš„è·¯å¾„ï¼š

```
// ä¼ªä»£ç 
const clip = `
  polygon(
    0 0, 100% 0, 100% 100%, 0 100%,
    0 ${rect.bottom}px,
    ${rect.right}px ${rect.bottom}px,
    ${rect.right}px ${rect.top}px,
    ${rect.left}px ${rect.top}px,
    ${rect.left}px ${rect.bottom}px,
    0 ${rect.bottom}px
  )
`;
overlay.style.clipPath = clip;
```

#### ğŸ”„ æ–¹æ¡ˆ Bï¼š`box-shadow` å›é€€ï¼ˆ`IE`/æ—§ `Safari`ï¼‰

- åˆ›å»ºä¸€ä¸ªä¸ç›®æ ‡å…ƒç´ **åŒæ ·å¤§å°å’Œä½ç½®**çš„ `<div class="driver-highlight">`

- è®¾ç½®å·¨å¤§å†…é˜´å½±æ¨¡æ‹Ÿé®ç½©ï¼š

  ```
  .driver-highlight {
    position: absolute;
    background: white;
    box-shadow: 0 0 0 9999px rgba(0,0,0,0.6);
    pointer-events: auto;
  }
  ```

>  `Driver.js` ä¼šè‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒ `clip-path`ï¼Œé€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆã€‚

### 4. **æ˜¾ç¤º `Popover`ï¼ˆæç¤ºæ¡†ï¼‰**

- åˆ›å»º `<div class="driver-popover">`
- æ ¹æ®ç›®æ ‡å…ƒç´ ä½ç½®å’Œé…ç½®ï¼ˆ`position: 'top' | 'bottom'` ç­‰ï¼‰ï¼Œè®¡ç®— `popover` çš„ `top`/`left`
- æ”¯æŒæ ‡é¢˜ã€æè¿°ã€å‰è¿›/åé€€/å…³é—­æŒ‰é’®
- ç»‘å®šæŒ‰é’®äº‹ä»¶ï¼ˆå¦‚ `onNext`, `onClose`ï¼‰

### 5. **é˜»æ­¢èƒŒæ™¯äº¤äº’ï¼ˆå¯é€‰ï¼‰**

- é»˜è®¤ `pointer-events: none` å…è®¸ç‚¹å‡»èƒŒæ™¯ã€‚
- è‹¥è®¾ç½® `allowClose: false`ï¼Œåˆ™é®ç½©å±‚è®¾ä¸º `pointer-events: auto`ï¼Œé˜»æ­¢ç”¨æˆ·æ“ä½œé¡µé¢å…¶ä»–éƒ¨åˆ†ã€‚

## ä¸‰ã€ä¸ºä»€ä¹ˆæ— æ³•è·Ÿè¸ªåŠ¨æ€å…ƒç´ ï¼Ÿ

æ ¹æœ¬åŸå› åœ¨äºï¼š

1. **ä½ç½®åªè®¡ç®—ä¸€æ¬¡**ï¼š`getBoundingClientRect()` åœ¨æ­¥éª¤å¼€å§‹æ—¶è°ƒç”¨ï¼Œç»“æœè¢«ç¼“å­˜ã€‚
2. **æ— ç›‘å¬æœºåˆ¶**ï¼š`Driver.js` **ä¸ä¼š**ç›‘å¬ `resize`ã€`scroll`ã€`DOM` å˜åŠ¨æˆ– `CSS` åŠ¨ç”»ã€‚
3. **é®ç½©æ˜¯é™æ€çš„**ï¼šä¸€æ—¦åˆ›å»ºï¼Œ`clip-path` è·¯å¾„ä¸å†æ›´æ–°ã€‚

ğŸ‘‰ æ‰€ä»¥å½“å…ƒç´ è¢«æ‹–æ‹½ã€åŠ¨ç”»ç§»åŠ¨ã€æˆ–é€šè¿‡ `JS` æ”¹å˜ä½ç½®åï¼Œé«˜äº®åŒºåŸŸä»åœç•™åœ¨**åˆå§‹åæ ‡**ï¼Œå¯¼è‡´é”™ä½ã€‚

## å››ã€æŠ€æœ¯æ ˆç‰¹ç‚¹

| ç‰¹æ€§           | è¯´æ˜                                   |
| -------------- | -------------------------------------- |
| **æ— ä¾èµ–**     | çº¯åŸç”Ÿ `JS`ï¼Œä¸ä¾èµ– `jQuery/React/Vue` |
| **ä½“ç§¯å°**     | å‹ç¼©åçº¦ `7KB`                         |
| **`API` ç®€æ´** | `new Driver().highlight(...)` ä¸€è¡Œæå®š |
| **ä¸»é¢˜å¯å®šåˆ¶** | é€šè¿‡ `CSS` å˜é‡æˆ–è¦†ç›– `class` ä¿®æ”¹æ ·å¼ |

## äº”ã€é€‚ç”¨åœºæ™¯ vs ä¸é€‚ç”¨åœºæ™¯

### âœ… é€‚åˆ

- é™æ€ç®¡ç†åå°çš„åŠŸèƒ½ä»‹ç»
- é¦–æ¬¡è®¿é—®æ—¶çš„ç®€å•æ“ä½œæŒ‡å¼•
- å…ƒç´ ä½ç½®å›ºå®šä¸å˜çš„é¡µé¢

### âŒ ä¸é€‚åˆ

- å¯æ‹–æ‹½/å¯æ’åºçš„ç•Œé¢ï¼ˆå¦‚ç”»å¸ƒã€çœ‹æ¿ï¼‰
- è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨ä¸­çš„å…ƒç´ 
- SPA ä¸­å¼‚æ­¥åŠ è½½çš„å†…å®¹
- éœ€è¦ç­‰å¾…ç”¨æˆ·å®ŒæˆæŸæ“ä½œå†ç»§ç»­çš„å¤æ‚æµç¨‹

##  æ€»ç»“

> **`Driver.js` çš„æœ¬è´¨æ˜¯ä¸€ä¸ªâ€œé™æ€å¿«ç…§å¼å¼•å¯¼å·¥å…·â€**ï¼š
>  å®ƒåœ¨æŸä¸€æ—¶åˆ»å¯¹é¡µé¢åšâ€œæˆªå›¾å¼é«˜äº®â€ï¼Œä½†ä¸å…·å¤‡æ„ŸçŸ¥é¡µé¢åç»­å˜åŒ–çš„èƒ½åŠ›ã€‚

å®ƒçš„ä¼˜åŠ¿æ˜¯ **ç®€å•ã€è½»é‡ã€å¼€ç®±å³ç”¨**ï¼›
 å®ƒçš„å±€é™æ˜¯ **é™æ€ã€ä¸å¯è¿½è¸ªã€æµç¨‹æ§åˆ¶å¼±**ã€‚

å¦‚æœä½ éœ€è¦åŠ¨æ€è·Ÿè¸ªã€å¤æ‚äº¤äº’æˆ–ä¼ä¸šçº§ç¨³å®šæ€§ï¼Œå»ºè®®è€ƒè™‘ **`Shepherd.js`**ï¼ˆåŸºäº `Popper.js`ï¼Œå®æ—¶å®šä½ï¼‰æˆ– **`Intro.js`**ï¼ˆæ”¯æŒ `refresh()`ï¼‰ã€‚



# åˆ¤æ–­`jsPlumb`èŠ‚ç‚¹æ˜¯å¦æˆç¯

## 1ã€`DFS` + ç™½ç°é»‘ä¸‰è‰²æ ‡è®°æ³•ï¼ˆé«˜æ•ˆä¸”æ˜“å®ç°ï¼‰

### æ­¥éª¤ï¼š

1. æ„å»ºé‚»æ¥è¡¨ï¼š`graph = { nodeId: [neighbor1, neighbor2, ...] }`
2. å¯¹æ¯ä¸ªæœªè®¿é—®èŠ‚ç‚¹è¿›è¡Œ `DFS` 
3. è‹¥åœ¨ `DFS` è¿‡ç¨‹ä¸­é‡åˆ° **æ­£åœ¨é€’å½’æ ˆä¸­çš„èŠ‚ç‚¹ï¼ˆç°è‰²ï¼‰**ï¼Œåˆ™å­˜åœ¨ç¯

æƒ³è±¡ä½ æ˜¯ä¸€ä¸ª**å¿«é€’å‘˜**ï¼Œä»»åŠ¡æ˜¯æ£€æŸ¥ä¸€ä¸ªåŸå¸‚çš„é€è´§è·¯çº¿ä¼šä¸ä¼šå…œåœˆå­ã€‚

- **æ¯ä¸ªèŠ‚ç‚¹ = ä¸€ä¸ªå°åŒº**ï¼ˆAã€Bã€Câ€¦ï¼‰
- **æ¯æ¡è¿çº¿ = ä¸€æ¡å•å‘é€è´§è·¯çº¿**ï¼ˆA â†’ B è¡¨ç¤ºåªèƒ½ä» A é€åˆ° Bï¼‰
- **ä½ çš„ç›®æ ‡**ï¼šçœ‹çœ‹æ˜¯å¦å­˜åœ¨ä¸€æ¡è·¯çº¿ï¼Œè®©ä½ **ä»æŸä¸ªå°åŒºå‡ºå‘ï¼Œæœ€ååˆç»•å›è‡ªå·±**

### ä½ éšèº«å¸¦ä¸¤ä¸ªæœ¬å­ï¼š

| æœ¬å­                   | ä½œç”¨                                     | å¯¹åº”ä»£ç        |
| ---------------------- | ---------------------------------------- | -------------- |
| **å·²å®Œæˆæœ¬**ï¼ˆé»‘è‰²ï¼‰   | è®°å½•â€œå·²ç»å½»åº•æ£€æŸ¥è¿‡ã€ç¡®è®¤ä¸ä¼šå…œåœˆâ€çš„å°åŒº | `visited` Set  |
| **å½“å‰è·¯çº¿æœ¬**ï¼ˆç°è‰²ï¼‰ | è®°å½•â€œè¿™æ¬¡é€è´§æ­£åœ¨ç»è¿‡çš„å°åŒºâ€             | `recStack` Set |

 ![project14](..\images\project14.jpg)`graph = { A: [B, C, D],B:[E],C:[E],D:[F] }`

```
function dfs(node) {
  // 1. å¦‚æœ node åœ¨â€œå½“å‰è·¯çº¿æœ¬â€ï¼ˆrecStackï¼‰é‡Œ â†’ æˆç¯ï¼
  if (recStack.has(node)) return true;

  // 2. å¦‚æœ node åœ¨â€œå·²å®Œæˆæœ¬â€ï¼ˆvisitedï¼‰é‡Œ â†’ è·³è¿‡ï¼ˆå·²æ£€æŸ¥è¿‡ï¼‰
  if (visited.has(node)) return false;

  // 3. æŠŠ node åŠ å…¥ä¸¤ä¸ªæœ¬å­
  visited.add(node);    // æ ‡è®°ä¸ºâ€œå·²å¼€å§‹æ£€æŸ¥â€
  recStack.add(node);   // åŠ å…¥å½“å‰é€è´§è·¯çº¿

  // 4. ç»§ç»­é€ä¸‹ä¸€ç«™ï¼ˆéå†æ‰€æœ‰é‚»å±…ï¼‰
  for (const neighbor of neighbors) {
    if (dfs(neighbor)) return true; // å¦‚æœä¸‹ä¸€ç«™å‘ç°ç¯ï¼Œç›´æ¥ä¸ŠæŠ¥
  }

  // 5. è¿™æ¡è·¯çº¿èµ°å®Œäº†ï¼ŒæŠŠ node ä»â€œå½“å‰è·¯çº¿æœ¬â€ç§»é™¤
  recStack.delete(node);
  return false;
}
```

ä½¿ç”¨æ·±åº¦éå†æ¯ä¸€æ¡è·¯,

#### `dfs(A):`

```
visited:[A]

recStack:[A]

neighbors:[B,C,D]

dfs(B):

visited:[A,B]

recStack:[A ,B]

neighbors:[E]

dfs(E):

visited:[A,B,E]

recStack:[A ,B,E]

neighbors:[]

recStack.delete(E);

recStack:[A ,B]

recStack.delete(B);

recStack:[A ]
A->B->Eè¿™æ¡è·¯å®Œå…¨èµ°é€šï¼Œä¸”æ— ç¯
```



#### `dfs(C):`

```
visited:[A,B,E,C]

recStack:[A ,C]

neighbors:[E]

dfs(E):

visited.has(E)=true

recStack.delete(C);

recStack:[A ]

A->C->Eè¿™æ¡è·¯å®Œå…¨èµ°é€šï¼Œä¸”æ— ç¯
```



#### `dfs(D):`

```
visited:[A,B,E,D]

recStack:[A,D]

neighbors:[F]

dfs(F):

visited:[A,B,E,D,F]

recStack:[A,D,F]

neighbors:[]

recStack.delete(F);

recStack:[A ,D]

recStack.delete(D);

recStack:[A ]

recStack.delete(A);

recStack:[ ]

A->D->Fè¿™æ¡è·¯å®Œå…¨èµ°é€šï¼Œä¸”æ— ç¯
```

## å®Œæ•´ä»£ç  

```
/**
 * æ£€æµ‹æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯
 * @param {Object} connections - æ‰€æœ‰è¿æ¥çš„æ˜ å°„ï¼Œæ ¼å¼: { sourceId: [targetId1, targetId2, ...] }
 * @returns {boolean} true è¡¨ç¤ºå­˜åœ¨ç¯
 */
function hasCycle(connections) {
  const visited = new Set();      // é»‘è‰²ï¼šå·²å®Œæˆ DFS
  const recStack = new Set();     // ç°è‰²ï¼šå½“å‰é€’å½’æ ˆä¸­

  function dfs(node) {
    if (recStack.has(node)) {
      // é‡åˆ°é€’å½’æ ˆä¸­çš„èŠ‚ç‚¹ â†’ æˆç¯ï¼
      return true;
    }
    if (visited.has(node)) {
      // å·²å®Œæˆéå†ï¼Œæ— ç¯
      return false;
    }

    visited.add(node);
    recStack.add(node);

    const neighbors = connections[node] || [];
    for (const neighbor of neighbors) {
      if (dfs(neighbor)) {
        return true;
      }
    }

    recStack.delete(node); // å›æº¯ï¼šé€€å‡ºé€’å½’æ ˆ
    return false;
  }

  // éå†æ‰€æœ‰èŠ‚ç‚¹ï¼ˆé˜²æ­¢å›¾ä¸è¿é€šï¼‰
  const allNodes = new Set();
  for (const src in connections) {
    allNodes.add(src);
    for (const tgt of connections[src]) {
      allNodes.add(tgt);
    }
  }

  for (const node of allNodes) {
    if (!visited.has(node)) {
      if (dfs(node)) return true;
    }
  }
  return false;
}
```

## 2ã€åœ¨ `jsPlumb` ä¸­æ‹¦æˆªæˆç¯è¿æ¥

### æ–¹æ³•ï¼šä½¿ç”¨ `beforeDrop` äº‹ä»¶ï¼ˆæ¨èï¼‰

```
jsPlumbInstance.bind('beforeDrop', (info) => {
  // info.sourceId, info.targetId æ˜¯å³å°†è¿æ¥çš„ä¸¤ç«¯

  // 1. è·å–å½“å‰æ‰€æœ‰è¿æ¥ï¼ˆåŒ…æ‹¬è¿™æ¬¡å°è¯•çš„è¿æ¥ï¼‰
  const tempConnections = buildConnectionGraph();
  // æ·»åŠ æœ¬æ¬¡å°è¯•çš„è¿æ¥
  if (!tempConnections[info.sourceId]) {
    tempConnections[info.sourceId] = [];
  }
  tempConnections[info.sourceId].push(info.targetId);

  // 2. æ£€æµ‹æ˜¯å¦æˆç¯
  if (hasCycle(tempConnections)) {
    alert('âŒ ä¸èƒ½åˆ›å»ºå¾ªç¯ä¾èµ–ï¼');
    return false; // é˜»æ­¢è¿æ¥å»ºç«‹
  }

  return true; // å…è®¸è¿æ¥
});
```

### è¾…åŠ©å‡½æ•°ï¼šæ„å»ºå½“å‰è¿æ¥å›¾

```
/**
 * ä» jsPlumb å®ä¾‹ä¸­æå–æ‰€æœ‰è¿æ¥ï¼Œæ„å»ºé‚»æ¥è¡¨
 * @returns {Object} { sourceId: [targetId, ...] }
 */
function buildConnectionGraph() {
  const graph = {};
  const connections = jsPlumbInstance.getAllConnections();
  
  connections.forEach(conn => {
    const src = conn.sourceId;
    const tgt = conn.targetId;
    if (!graph[src]) graph[src] = [];
    graph[src].push(tgt);
  });
  
  return graph;
}
```