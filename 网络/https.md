一、概念

https是以安全为目标的http通道，简单讲就是http的安全版，即在http下加入ssl层，http的安全基础是ssl,因此加密的详细内容就需要ssl，HTTPS=HTTP+SSL/TLS

二、SSL(安全套接层)/TLS(传输安全层)

1.TLS和SSL关系

    - TLS(传输安全层)的前身是SSL(安全套接层),TLS1.0通常被标示为SSL3.1，TLS1.1为SSL3.2,TLS1.2为SSL3.3,所以TLS相当于SSL3.0的后续版本，现在人们用的基本上是TLS，由于 SSL 这一术语更为常用，因此我们仍然将我们的安全证书称作 SSL

    - SSL协议可分为两层： 
  
       - SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持
       - SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等

    - 安全传输层协议（TLS）用于在两个通信应用程序之间提供保密性和数据完整性。该协议由两层组成： TLS 记录协议（TLS Record）和 TLS 握手协议（TLS Handshake）

2.SSL/TLS协议是为了解决这三大风险而设计的，希望达到：

    - 所有信息都是加密传播，第三方无法窃听。
    - 具有校验机制，一旦被篡改，通信双方会立刻发现。
     - 配备身份证书，防止身份被冒充

3.加密
  
    - SSL/TLS分为对称加密和非对称加密两种方式：

           - 对称加密：加密和解密都用同一份密钥，常用的对称加密算法有AES-128，AES-192，AES-256
           - 非对称加密:对应于一对密钥，称为私钥和公钥，用私钥加密后需要用公钥解密，用公钥加密后需要用私钥解密

    - 对称加密的优点是运算速度快，缺点是互联网环境下无法将密钥安全的传送给对方。非对称加密的优点是可以安全的将公钥传递给对方，但是运算速度慢
    - HTTPS是采用对称加密+非对称加密,先采用非对称加密传输协商对称加密的密钥，然后用对称加密通信

4.数字签名

     - 数字签名是附加在报文上的特殊加密校验码。数字签名通常是用非对称公开密钥技术产生的
     
     - 例子理解

           - 鲍勃有两把钥匙，一把是公钥，另一把是私钥，鲍勃把公钥送给他的朋友们----帕蒂、道格、苏珊----每人一把
           - 苏珊要给鲍勃写一封保密的信。她写完后用鲍勃的公钥加密，就可以达到保密的效果
           - 鲍勃收信后，用私钥解密，就看到了信件内容。这里要强调的是，公钥加密的东西只有私钥能解密，只要私钥不泄露，内容永远是安全的
           - 鲍勃给苏珊回信，决定采用"数字签名"。他写完后先用Hash函数，生成信件的摘要（digest），然后，鲍勃使用私钥，对这个摘要加密，生成"数字签名"（signature），鲍勃将这个签名，附在信件下面，和信件一起发给苏珊。
           - 苏珊收信后，取下数字签名，用鲍勃的公钥解密，得到信件的摘要。由此证明，这封信确实是鲍勃发出的。
           - 苏珊再对信件本身使用Hash函数，将得到的结果，与上一步得到的摘要进行对比。如果两者一致，就证明这封信未被修改过

5.数字证书

    - 数字证书中包含了由某个受信任组织担保的用户或公司的相关信息
    - 数字证书中还包含一组信息，所有这些信息都是由一个官方的证书颁发机构(CA)以数字方式签发的
    - SSL证书中包含的具体内容有：

          - 证书的发布机构CA
          - 证书的有效期
          - 公钥(如上例中鲍勃的公钥)
          - 证书所有者
          - 数字签名(先通过Hash函数计算得到证书数字摘要，然后用CA私钥加密数字摘要得到数字签名)
          - ......
   

6.SSL/TLS握手过程

     - (1)客户端的浏览器向服务器传送客户端SSL协议的版本号，加密算法的种类，产生的随机数，以及其他服务器和客户端之间通讯所需要的各种信息
     - (2)服务器向客户端传送SSL协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书
     - (3)客户端在接受到服务端发来的SSL证书时，会对证书的真伪进行校验，以浏览器为例说明如下：

            - 首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验
            - 浏览器开始查找操作系统中已内置的受信任的证书发布机构CA，与服务器发来的证书中的颁发者CA比对，用于校验证书是否为合法机构颁发 
            - 如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的
            - 如果找到，那么浏览器就会从操作系统中取出颁发者CA的公钥，然后对服务器发来的证书里面的签名进行解密
            - 浏览器使用相同的hash算法计算出服务器发来的证书的hash值，将这个计算的hash值与证书中签名做对比
            - 对比结果一致，则证明服务器发来的证书合法，没有被冒充
            - 此时浏览器就可以读取证书中的公钥，用于后续加密了

     - (4)客户端随机产生一随机数，然后用服务器的公钥（服务器的公钥从步骤3中的服务器的证书中获得）对其加密，然后传给服务器
     - (5)服务器用私钥获取客户端发来的随机数
     - (6)客户端和服务器根据约定的加密方法，使用前面的三个随机数(第一步，第二步和第四步产生的随机数)，生成对话密钥（session key），用来加密接下来的整个对话过程
     - (7)客户端向服务器端发出信息，指明后面的数据通讯将使用的步骤6中的主密码为对称密钥，同时通知服务器客户端的握手过程结束
     - (8)服务器向客户端发出信息，指明后面的数据通讯将使用的步骤6中的主密码为对称密钥，同时通知客户端服务器端的握手过程结束
     - (9)SSL 的握手部分结束，SSL安全通道的数据通讯开始，客户和服务器开始使用相同的对称密钥进行数据通讯，同时进行通讯完整性的检验

7.握手阶段有三点注意

     - 生成对话密钥一共需要三个随机数
     - 握手之后的对话使用对话密钥加密（对称加密），服务器的公钥和私钥只用于加密和解密对话密钥（session key）（非对称加密），无其他作用
     - 服务器公钥放在服务器的数字证书之中

三、https握手

   - TCP握手+SSL/TSL握手
   - TLS的握手阶段是发生在TCP握手之后

四、HTTPS的缺点

   - HTTPS协议握手阶段比较费时，会使页面的加载时间延长近50%，增加10%到20%的耗电；对网站的响应速度也有影响，影响用户体验。比较好的方式是采用分而治之，类似12306网站的主页使用HTTP协议，有关于用户信息等方面使用HTTPS
   - HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗，甚至已有的安全措施也会因此而受到影响；
   - SSL证书需要钱，功能越强大的证书费用越高，个人网站、小网站没有必要一般不会用。
   - SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名，IPv4资源不可能支撑这个消耗。
   - HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。


五、http和https的区别

   - https协议需要到ca申请证书，一般免费证书很少，需要交费。 
   - http是超文本传输协议，信息是明文传输，https 则是具有安全性的ssl加密传输协议 
   - http和https使用的是完全不同的连接方式用的端口也不一样,前者是80,后者是443。 
         - http的连接很简单,是无状态的 
         - HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议 要比http协议安全

   - HTTPS连接缓存不如HTTP高效，流量成本高。
   - HTTPS连接服务器端资源占用高很多，支持访客多的网站需要投入更大的成本。
   

