# 一、`UDP`协议简介 #

`UDP`是传输层的协议，功能即为在`IP`的数据报服务之上增加了最基本的服务：复用和分用以及差错检测。

## `UDP`提供不可靠服务，具有`TCP`所没有的优势：

#### `UDP`无连接

`UDP`无连接，时间上不存在建立连接需要的时延。空间上，`TCP`需要在端系统中维护连接状态，需要一定的开销。此连接装入包括接收和发送缓存，拥塞控制参数和序号与确认号的参数。`UDP`不维护连接状态，也不跟踪这些参数，开销小。空间和时间上都具有优势。

举个例子：

`DNS`如果运行在`TCP`之上而不是`UDP`，那么`DNS`的速度将会慢很多。
`HTTP`使用`TCP`而不是`UDP`，是因为对于基于文本数据的Web网页来说，可靠性很重要。
同一种专用应用服务器在支持`UDP`时，一定能支持更多的活动客户机。

#### 分组首部开销小

`TCP`首部20字节，`UDP`首部8字节。 

#### `UDP`没有拥塞控制

应用层能够更好的控制要发送的数据和发送时间，网络中的拥塞控制也不会影响主机的发送速率。某些实时应用要求以稳定的速度发送，能容忍一些数据的丢失，但是不能允许有较大的时延（比如实时视频，直播等）

#### `UDP`提供尽最大努力的交付，不保证可靠交付。

所有维护传输可靠性的工作需要用户在应用层来完成。没有`TCP`的确认机制、重传机制。如果因为网络原因没有传送到对端，`UDP`也不会给应用层返回错误信息

#### `UDP`是面向报文的

对应用层交下来的报文，添加首部后直接向下交付为`IP`层，既不合并，也不拆分，保留这些报文的边界。对`IP`层交上来`UDP`用户数据报，在去除首部后就原封不动地交付给上层应用进程，报文不可分割，是`UDP`数据报处理的最小单位。

- 正是因为这样，`UDP`显得不够灵活，不能控制读写数据的次数和数量。比如我们要发送100个字节的报文，我们调用一次sendto函数就会发送100字节，对端也需要用recvfrom函数一次性接收100字节，不能使用循环每次获取10个字节，获取十次这样的做法。

#### `UDP`常用一次性传输比较少量数据的网络应用

`UDP`常用一次性传输比较少量数据的网络应用，如`DNS`,SNMP等，因为对于这些应用，若是采用`TCP`，为连接的创建，维护和拆除带来不小的开销。`UDP`也常用于多媒体应用（如`IP`电话，实时视频会议，流媒体等）数据的可靠传输对他们而言并不重要，`TCP`的拥塞控制会使他们有较大的延迟，也是不可容忍的


# 二、`TCP`和`UDP`比较 #

- `TCP`提供面向连接的传输，通信前要先建立连接（三次握手机制）； `UDP`提供无连接的传输，通信前不需要建立连接。
- `TCP`提供可靠的传输（有序，无差错，不丢失，不重复）； `UDP`提供不可靠的传输。
- `TCP`通过校验和，重传控制，序号标识，滑动窗口、确认应答实现可靠传输。如丢包时的重发控制，还可以对次序乱掉的分包进行顺序控制  
- `TCP`面向字节流的传输，因此它能将信息分割成组，并在接收端将其重组； `UDP`是面向数据报的传输，没有分组开销。
- `TCP`提供拥塞控制和流量控制机制； `UDP`不提供拥塞控制和流量控制机制。
- 每一条`TCP`连接只能是点到点的;`UDP`支持一对一，一对多，多对一和多对多的交互通信

# 三、为什么`UDP`有时比`TCP`更有优势? #

`UDP`以其简单、传输快的优势，在越来越多场景下取代了`TCP`,如实时游戏。

（1）网速的提升给`UDP`的稳定性提供可靠网络保障，丢包率很低，如果使用应用层重传，能够确保传输的可靠性。

（2）`TCP`为了实现网络通信的可靠性，使用了复杂的拥塞控制算法，建立了繁琐的握手过程，由于`TCP`内置的系统协议栈中，极难对其进行改进。

采用`TCP`，一旦发生丢包，`TCP`会将后续的包缓存起来，等前面的包重传并接收到后再继续发送，延时会越来越大，基于`UDP`对实时性要求较为严格的情况下，采用自定义重传机制，能够把丢包产生的延迟降到最低，尽量减少网络问题对游戏性造成影响。

# 四、长连接和短链接 #

- `HTTP`的长连接和短连接本质上是`TCP`长连接和短连接。`HTTP`属于应用层协议，在传输层使用`TCP`协议，在网络层使用`IP`协议。 `IP`协议主要解决网络路由和寻址问题，`TCP`协议主要解决如何在`IP`层之上可靠地传递数据包，使得网络上接收端收到发送端所发出的所有包，并且顺序与发送顺序一致。`TCP`协议是可靠的、面向连接的。
- 在`HTTP`/1.0中默认使用短连接。也就是说，客户端和服务器每进行一次`HTTP`操作，就建立一次连接，任务结束就中断连接。当客户端浏览器访问的某个HTML或其他类型的Web页中包含有其他的Web资源（如JavaScr`IP`t文件、图像文件、CSS文件等），每遇到这样一个Web资源，浏览器就会重新建立一个`HTTP`会话。
- 而从`HTTP`/1.1起，默认使用长连接，用以保持连接特性。使用长连接的`HTTP`协议，会在响应头加入这行代码：

			Connection:keep-alive

- 在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输`HTTP`数据的`TCP`连接不会关闭，客户端再次访问这个服务器时，会继续使用这一条已经建立的连接。Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接需要客户端和服务端都支持长连接。

