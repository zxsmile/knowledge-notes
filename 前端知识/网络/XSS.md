一、XSS(Cross Site Scripting  跨站脚本攻击)

1.什么是跨域脚本攻击？

   - XSS是一种代码注入攻击，攻击者通过在目标网站上注入恶意脚本，使之在用户浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如cookie，sessionID,进而危害数据安全
   - XSS攻击涉及到三方：攻击者，用户，web server,用户通过浏览器来访问web server上的网页，XSS攻击就是攻击者通过各种办法，在用户访问的网页中插入自己的脚本，让其在用户访问网页时，在用户的     浏览器中进行执行，攻击者通过插入的脚本的执行，来获得用户的信息，比如cookie，发送到攻击者自己的网站(跨站了)。所以称为跨站脚本攻击
   - XSS的本质是：恶意代码未经过滤，与网站代码混在一起，浏览器无法分辨那些脚本是可信的，导致恶意代码被执行
   - 而由于直接在用户终端执行，恶意代码能够直接获取用户信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求

2.实施XSS攻击需要满足的两个条件

   - 需要向web页面注入恶意代码
   - 这些恶意代码能够被浏览器成功执行

3.XSS根据攻击脚本的引入位置可分为三类

   (1) 反射型 XSS

         - 代码出现在url里边，作为输入提交到服务器端
         - 反射型XSS也就是非持久性XSS，诱导用户点击攻击链接，服务器解析后响应，在返回的响应内容中包含恶意代码，被浏览器执行。一来一去，XSS攻击脚本被web server反射回来给浏览器执行所以叫反射型XSS
         - 特点：

               - XSS攻击代码非持久性，也就是没有被保存在web server中，而是出现在url里面
               - 非持久性，那么攻击方式就不同了，一般攻击者通过聊天软件，邮件等等方式发送攻击url，然后用户点击来达到攻击目的
   
   (2) 存储型 XSS

          - 提交的代码会存储在服务器端，不用再提交XSS攻击代码了
          - 存储型XSS也就是持久性XSS
          - 特点：

                - XSS攻击代码存储于web server上
                - 攻击者，一般是通过网站的留言、评论、博客、日志等等功能(所有能够向web server输入内容的地方)，将攻击代码存储到web server上的
                - 有时持久性XSS和反射型XSS是同时使用的，比如先通过对一个攻击url进行编码(来绕过xss filter)，然后提交该web server(存储在web server中), 然后用户在浏览页面时，如果点击该url，就会触发一个XSS攻击。当然用户点击该url时，也可能会触发一个CSRF(Cross site request forgery)攻击

   (3) DOM型 XSS

           - 基于DOM的XSS，也就是web server不参与，仅仅涉及到浏览器的XSS
           - 比如根据用户的输入来动态构造一个DOM节点，如果没有对用户的输入进行过滤，那么也就导致XSS攻击的产生


4.XSS存在的原因

     - XSS存在的根本原因是，对URL中的参数，对用户提交到服务器的内容没有进行充分的过滤，但是充分而完全的过滤实际上是无法实现的

5.XSS的防御

     - 在表单提交或者url参数传递前，对需要的参数进行过滤
     - 对输出进行编码
     

           - 在输出数据之前对潜在的威胁的字符进行编码、转义是防御XSS攻击十分有效的措施
           - 对所有要动态输出到页面的内容，通通进行相关的编码和转义。当然转义是按照其输出的上下文环境来决定如何转义的

                 - 1.作为body文本输出，作为html标签的属性输出

                       比如：<span>${username}</span>, <p><c:out value="${username}"></c:out></p>

							<input type="text" value="${username}" />
							
							此时的转义规则如下：
							
							< 转成 &lt;
							
							> 转成 &gt;
							
							& 转成 &amp;
							
							" 转成 &quot;
                 
                - 2.javascript事件

                     <input type="button" οnclick='go_to_url("${myUrl}");' />

					除了上面的那些转义之外，还要附加上下面的转义：
					
					\ 转成 \\
					
					/ 转成 \/
					
					; 转成 ；(全角;)

               - 3.URL属性

                    如果 <script>, <style>, <imt> 等标签的 src 和 href 属性值为动态内容，那么要确保这些url没有执行恶意连接。

					确保：href 和 src 的值必须以 http://开头，白名单方式；不能有10进制和16进制编码字符

               - 4.HttpOnly 与 XSS防御

                   XSS 一般利用js脚步读取用户浏览器中的Cookie，而如果在服务器端对 Cookie 设置了HttpOnly 属性，那么js脚本就不能读取到cookie，但是浏览器还是能够正常使用cookie

                   一般的Cookie都是从document对象中获得的，现在浏览器在设置 Cookie的时候一般都接受一个叫做HttpOnly的参数，跟domain等其他参数一样，一旦这个HttpOnly被设置，你在浏览器的 document对象中就看不到Cookie了，而浏览器在浏览的时候不受任何影响，因为Cookie会被放在浏览器头中发送出去(包括ajax的时 候)，应用程序也一般不会在js里操作这些敏感Cookie的，对于一些敏感的Cookie我们采用HttpOnly，对于一些需要在应用程序中用js操作的cookie我们就不予设置，这样就保障了Cookie信息的安全也保证了应用
    


